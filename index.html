<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Ads Creator | Soundvertise</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;800&family=Courier+Prime:wght@400;700&family=Inter:wght@400;600;800&family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/mp4-muxer@latest/build/mp4-muxer.js"></script>
    <style>
        :root {
            --sv-purple: #8B5CF6;
            --sv-blue: #3B82F6;
            --sv-bg: #050505;
            --sv-card: #0F0F0F;
        }

        body {
            background-color: var(--sv-bg);
            color: #ffffff;
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow-x: hidden;
        }

        .preview-column {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 80vh;
        }

        .iphone-frame {
            width: 290px;
            height: calc(290px * 16 / 9);
            border: 10px solid #1A1A1A;
            border-radius: 42px;
            position: relative;
            background: #000;
            overflow: hidden;
            box-shadow: 0 0 0 2px #000, 0 20px 50px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
        }

        .notch {
            position: absolute;
            top: 12px;
            left: 50%;
            transform: translateX(-50%);
            width: 75px;
            height: 22px;
            background: #000;
            border-radius: 20px;
            z-index: 50;
            border: 1px solid #222;
        }

        .video-container {
            width: 100%;
            height: 100%;
            position: relative;
            background: #000;
            overflow: hidden;
        }

        video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            transition: transform 0.3s ease;
        }

        #caption-overlay {
            position: absolute;
            cursor: move;
            user-select: none;
            text-align: center;
            max-width: 85%;
            word-wrap: break-word;
            z-index: 30;
            display: block;
            line-height: 1.1;
            left: 50%;
            transform: translateX(-50%);
            --outline-color: #000000;
            paint-order: stroke fill;
        }
        
        #caption-overlay:not(.dragging) {
            transition: top 0.1s ease-out;
        }

        .text-bold-outline {
            text-shadow: 
                0 0 1px var(--outline-color),
                -1.5px -1.5px 0 var(--outline-color),  
                 1.5px -1.5px 0 var(--outline-color),
                -1.5px  1.5px 0 var(--outline-color),
                 1.5px  1.5px 0 var(--outline-color),
                 0px 3px 8px rgba(0,0,0,0.6);
        }

        .tiktok-ui-overlay {
            position: absolute;
            inset: 0;
            pointer-events: none;
            z-index: 40;
            display: block;
            background: linear-gradient(to top, rgba(0,0,0,0.5) 0%, transparent 20%, transparent 80%, rgba(0,0,0,0.2) 100%);
        }

        .right-actions {
            position: absolute;
            right: 8px;
            bottom: 85px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            align-items: center;
        }

        .action-text { font-size: 8px; font-weight: 600; }

        .bottom-info {
            position: absolute;
            left: 12px;
            bottom: 20px;
            max-width: 190px;
        }

        .trimmer-track {
            position: relative;
            width: 100%;
            background: #111;
            border-radius: 12px;
            border: 1px solid #333;
            overflow: hidden;
            cursor: pointer;
        }

        .thumbnail-track {
            position: absolute;
            inset: 0;
            display: flex;
            pointer-events: none;
            opacity: 0.4;
        }

        .thumbnail-track canvas {
            height: 100%;
            flex: 1;
            object-fit: cover;
        }

        .trim-overlay {
            position: absolute;
            top: 0;
            height: 100%;
            z-index: 5;
            cursor: grab;
            border-radius: 6px;
        }

        #video-trim-overlay {
            background: rgba(59, 130, 246, 0.2);
            border: 3px solid var(--sv-blue);
        }

        #audio-trim-overlay {
            background: rgba(139, 92, 246, 0.15);
            border: 3px solid var(--sv-purple);
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.3);
        }

        .playhead-cursor {
            position: absolute;
            top: 0;
            width: 2px;
            height: 100%;
            background: #ffffff;
            z-index: 20;
            pointer-events: none;
            box-shadow: 0 0 10px rgba(255,255,255,0.8);
        }

        .trim-handle {
            position: absolute;
            top: 0;
            width: 16px;
            height: 100%;
            background: inherit;
            cursor: ew-resize;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }
        
        #video-trim-overlay .trim-handle { background-color: var(--sv-blue); }
        #audio-trim-overlay .trim-handle { display: none; }

        .trim-handle::after {
            content: '';
            width: 2px;
            height: 14px;
            background: white;
            border-radius: 1px;
        }
        .handle-left { left: -8px; border-radius: 6px 0 0 6px; }
        .handle-right { right: -8px; border-radius: 0 6px 6px 0; }

        .waveform-wrapper {
            position: relative;
            width: 100%;
            height: 70px;
            background: #000;
        }

        #waveform { width: 100%; height: 100%; pointer-events: none; }

        .btn-sv {
            background: linear-gradient(135deg, var(--sv-blue) 0%, var(--sv-purple) 100%);
            transition: all 0.3s ease;
        }
        .btn-sv:hover { filter: brightness(1.1); transform: scale(1.02); }
        .btn-sv:disabled { opacity: 0.5; cursor: not-allowed; filter: grayscale(1); }

        .font-tiktok { font-family: 'Montserrat', sans-serif; font-weight: 800; letter-spacing: -0.5px; }
        .font-typewriter { font-family: 'Courier Prime', monospace; }
        .font-classic { font-family: 'Inter', sans-serif; font-weight: 800; }
        .font-handwriting { font-family: 'Dancing Script', cursive; font-weight: 700; }

        .font-btn {
            background: #000;
            border: 1px solid #333;
            padding: 8px 12px;
            border-radius: 10px;
            font-size: 10px;
            transition: all 0.2s;
            color: #666;
        }
        .font-btn.active {
            border-color: var(--sv-blue);
            background: rgba(59, 130, 246, 0.1);
            color: #fff;
        }

        .color-wrapper {
            position: relative;
            width: 36px;
            height: 36px;
            border-radius: 8px;
            border: 1px solid #333;
            overflow: hidden;
            background: #000;
            flex-shrink: 0;
        }
        
        .color-input {
            position: absolute;
            width: 200%;
            height: 200%;
            top: -50%;
            left: -50%;
            cursor: pointer;
        }

        .toggle-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 12px;
            background: #111;
            border: 1px solid #333;
            font-size: 10px;
            font-weight: 800;
            text-transform: uppercase;
            transition: all 0.2s;
            color: #666;
            cursor: pointer;
        }
        .toggle-btn.active {
            background: rgba(59, 130, 246, 0.15);
            border-color: var(--sv-blue);
            color: #fff;
        }

        .caption-cat-btn {
            background: #000;
            border: 1px solid #333;
            padding: 6px 10px;
            border-radius: 8px;
            font-size: 9px;
            font-weight: 800;
            text-transform: uppercase;
            transition: all 0.2s;
            color: #666;
            cursor: pointer;
        }
        .caption-cat-btn.active {
            border-color: var(--sv-purple);
            background: rgba(139, 92, 246, 0.15);
            color: #fff;
        }
        .caption-cat-btn:hover {
            border-color: var(--sv-purple);
            color: #fff;
        }

        #render-canvas {
            display: none;
        }

        .queue-item {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid #333;
            padding: 8px 12px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
            transition: all 0.2s;
        }

        .queue-item.active {
            border-color: var(--sv-blue);
            background: rgba(59, 130, 246, 0.15);
        }

        .queue-item:hover {
            border-color: var(--sv-blue);
        }

        .queue-item-info {
            flex: 1;
            min-width: 0;
        }

        .queue-item-caption {
            font-size: 10px;
            font-weight: 700;
            color: #fff;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .queue-item-meta {
            font-size: 8px;
            color: #888;
            margin-top: 2px;
        }

        .queue-item-actions {
            display: flex;
            gap: 4px;
        }

        .queue-item-btn {
            padding: 4px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid #444;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .queue-item-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: #666;
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-7xl mx-auto w-full grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
        
        <!-- Preview Column -->
        <div class="preview-column space-y-6 order-2 lg:order-1">
            <div class="iphone-frame" id="iphone">
                <div class="notch"></div>
                <div class="video-container" id="drop-zone">
                    <video id="main-video" crossorigin="anonymous" playsinline loop muted></video>
                    <div id="caption-overlay" class="font-tiktok text-bold-outline" style="top: 35%; font-size: 12px; color: white;">
                        Scrivi il tuo testo
                    </div>
                    <div id="safe-guide" class="tiktok-ui-overlay">
                        <div class="right-actions">
                            <div class="action-item flex flex-col items-center">
                                <div class="w-9 h-9 rounded-full border border-white bg-zinc-800 mb-1 overflow-hidden">
                                    <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=SV" alt="avatar">
                                </div>
                            </div>
                            <div class="action-item flex flex-col items-center">
                                <i data-lucide="heart" class="text-white fill-white w-7 h-7"></i>
                                <span class="action-text text-white">580K</span>
                            </div>
                            <div class="action-item flex flex-col items-center">
                                <i data-lucide="message-circle" class="text-white fill-white w-7 h-7"></i>
                                <span class="action-text text-white">2.4K</span>
                            </div>
                        </div>
                        <div class="bottom-info space-y-0.5">
                            <p class="font-bold text-[11px]">@soundvertise.co</p>
                            <p class="text-[10px] opacity-90 leading-tight">Video creato con Soundvertise.</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="flex gap-3">
                <button id="toggle-guide" class="flex-1 px-5 py-2 bg-zinc-900 rounded-full text-[9px] font-black uppercase border border-zinc-800 hover:border-blue-500 transition-all text-zinc-400 hover:text-white">
                   Anteprima TikTok UI
                </button>
                <button id="toggle-watermark" class="toggle-btn">
                    <i data-lucide="zoom-in" class="w-3.5 h-3.5"></i>
                    Remove VEO
                </button>
            </div>
        </div>

        <!-- Editor Controls -->
        <div class="bg-zinc-900/40 border border-zinc-800 p-6 md:p-8 rounded-[2.5rem] space-y-6 backdrop-blur-xl order-1 lg:order-2">
            <header class="flex justify-between items-end border-b border-zinc-800/50 pb-4">
                <div>
                    <h1 class="text-xl font-black italic uppercase">Video <span class="text-blue-400">Ads Creator</span></h1>
                    <p class="text-[9px] font-bold tracking-widest text-zinc-600">SOUNDVERTISE</p>
                </div>
                <div class="text-right">
                    <div class="flex items-center gap-3">
                        <div class="text-right">
                            <span id="video-dur-label" class="text-blue-400 font-mono text-xs font-bold uppercase block">Video: 15.0s</span>
                            <span id="queue-count" class="text-violet-400 font-mono text-[10px] font-bold uppercase">Coda: 0/20</span>
                        </div>
                    </div>
                </div>
            </header>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="space-y-1">
                    <label class="text-[9px] font-black uppercase text-zinc-500">File Video (Max 20)</label>
                    <label for="video-input" class="flex items-center gap-3 bg-black border border-zinc-800 p-3 rounded-xl cursor-pointer hover:border-blue-500 transition-all">
                        <i data-lucide="video" class="w-4 h-4 text-blue-400"></i>
                        <span class="text-[11px] text-zinc-400 truncate" id="video-label">Carica Video (Multipli)</span>
                        <input type="file" id="video-input" accept="video/*" multiple class="hidden">
                    </label>
                    <div id="video-files-list" class="text-[9px] text-zinc-500 mt-1"></div>
                </div>
                <div class="space-y-1">
                    <label class="text-[9px] font-black uppercase text-zinc-500">File Audio (Max 20)</label>
                    <label for="audio-input" class="flex items-center gap-3 bg-black border border-zinc-800 p-3 rounded-xl cursor-pointer hover:border-violet-500 transition-all">
                        <i data-lucide="music" class="w-4 h-4 text-violet-400"></i>
                        <span class="text-[11px] text-zinc-400 truncate" id="audio-label">Carica Audio (Multipli)</span>
                        <input type="file" id="audio-input" accept="audio/*" multiple class="hidden">
                    </label>
                    <div id="audio-files-list" class="text-[9px] text-zinc-500 mt-1"></div>
                </div>
            </div>

            <!-- Video Trimmer -->
            <div class="space-y-2">
                <div class="flex justify-between items-center text-[9px] font-black uppercase text-zinc-500">
                    <span>Ritaglia Clip Video (Max 30s)</span>
                    <span id="v-range-text">0.0s - 15.0s</span>
                </div>
                <div class="trimmer-track h-[54px]" id="v-trimmer-track">
                    <div class="thumbnail-track" id="v-thumbs"></div>
                    <div id="video-playhead" class="playhead-cursor" style="left: 0; display: none;"></div>
                    <div id="video-trim-overlay" class="trim-overlay">
                        <div class="trim-handle handle-left" id="v-handle-l"></div>
                        <div class="trim-handle handle-right" id="v-handle-r"></div>
                    </div>
                </div>
            </div>

            <!-- Audio Waveform Trimmer -->
            <div class="space-y-3 bg-black p-4 rounded-3xl border border-zinc-800/50">
                <div class="flex items-center gap-4">
                    <button id="play-btn" class="w-12 h-12 rounded-xl btn-sv text-white flex items-center justify-center shadow-lg shrink-0">
                        <i data-lucide="play" id="play-icon" class="w-5 h-5 fill-white"></i>
                    </button>
                    <div class="flex-1 space-y-1">
                        <div class="flex justify-between items-center text-[9px] font-black uppercase text-zinc-500">
                            <span>Onda Sonora (Loop Anteprima)</span>
                            <div class="flex items-center gap-2">
                                <select id="audio-selector" class="bg-zinc-900 border border-zinc-700 rounded px-2 py-1 text-[9px] text-zinc-300 font-bold cursor-pointer hover:border-violet-500 transition-all">
                                    <option value="">Nessun Audio</option>
                                </select>
                                <span id="audio-start-label">Start: 0.0s</span>
                            </div>
                        </div>
                        <div class="trimmer-track h-[70px]" id="a-trimmer-track">
                            <div class="waveform-wrapper">
                                <canvas id="waveform"></canvas>
                            </div>
                            <div id="audio-playhead" class="playhead-cursor" style="left: 0; display: none;"></div>
                            <div id="audio-trim-overlay" class="trim-overlay"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Content Editor -->
            <div class="p-5 bg-zinc-900/60 rounded-3xl border border-zinc-800 space-y-4">
                <!-- Viral Captions Generator -->
                <div class="space-y-3 p-4 bg-gradient-to-br from-violet-950/30 to-blue-950/30 rounded-2xl border border-violet-800/30">
                    <div class="flex items-center justify-between">
                        <span class="text-[10px] font-black uppercase text-violet-300 tracking-widest">‚ú® Caption Virali</span>
                        <button id="random-caption-btn" class="px-3 py-1.5 bg-violet-600 hover:bg-violet-500 rounded-lg text-[9px] font-black uppercase transition-all flex items-center gap-1.5">
                            <i data-lucide="shuffle" class="w-3 h-3"></i>
                            Random
                        </button>
                    </div>
                    <div class="grid grid-cols-4 sm:grid-cols-6 gap-1.5">
                        <button class="caption-cat-btn active" data-category="happy">üòä Happy</button>
                        <button class="caption-cat-btn" data-category="sad">üò¢ Sad</button>
                        <button class="caption-cat-btn" data-category="dance">üíÉ Dance</button>
                        <button class="caption-cat-btn" data-category="chill">üòå Chill</button>
                        <button class="caption-cat-btn" data-category="love">‚ù§Ô∏è Love</button>
                        <button class="caption-cat-btn" data-category="pov">üé¨ POV</button>
                        <button class="caption-cat-btn" data-category="gym">üí™ Gym</button>
                        <button class="caption-cat-btn" data-category="energy">‚ö° Energy</button>
                        <button class="caption-cat-btn" data-category="party">üéâ Party</button>
                        <button class="caption-cat-btn" data-category="viral">üî• Viral</button>
                        <button class="caption-cat-btn" data-category="beauty">‚ú® Beauty</button>
                        <button class="caption-cat-btn" data-category="sensual">üåô Sensual</button>
                        <button class="caption-cat-btn" data-category="savage">üòà Savage</button>
                        <button class="caption-cat-btn" data-category="aesthetic">üé® Aesthetic</button>
                        <button class="caption-cat-btn" data-category="relatable">üíÄ Relatable</button>
                        <button class="caption-cat-btn" data-category="dreamy">üåü Dreamy</button>
                        <button class="caption-cat-btn" data-category="chaotic">üåÄ Chaotic</button>
                        <button class="caption-cat-btn" data-category="main">‚≠ê Main Char</button>
                    </div>
                </div>

                <textarea id="caption-input" rows="2" placeholder="Scrivi il testo qui..." class="w-full bg-black border border-zinc-800 rounded-xl p-3 text-sm focus:ring-1 focus:ring-blue-500 outline-none resize-none font-semibold"></textarea>
                
                <div class="grid grid-cols-2 sm:grid-cols-4 gap-2">
                    <button class="font-btn active" data-font="font-tiktok">TIKTOK</button>
                    <button class="font-btn" data-font="font-typewriter">RETRO</button>
                    <button class="font-btn" data-font="font-classic">BOLD</button>
                    <button class="font-btn" data-font="font-handwriting">SCRIPT</button>
                </div>

                <div class="space-y-4 pt-2">
                    <div class="flex-1 space-y-2">
                        <div class="flex justify-between text-[9px] font-black text-zinc-500 uppercase tracking-widest">
                            <span>Dimensione Carattere</span>
                            <span id="fs-val" class="text-blue-400">12px</span>
                        </div>
                        <input type="range" id="font-size" min="12" max="60" value="12" class="w-full accent-blue-500 h-1 bg-zinc-800 rounded-lg appearance-none cursor-pointer">
                    </div>
                    
                    <div class="flex flex-col gap-4 p-4 bg-black/40 rounded-2xl border border-zinc-800/50">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <div class="color-wrapper shadow-lg"><input type="color" id="text-color" value="#ffffff" class="color-input"></div>
                                <span class="text-[9px] font-black text-zinc-400 uppercase tracking-widest">Colore Testo</span>
                            </div>

                            <div class="h-6 w-[1px] bg-zinc-800"></div>

                            <div class="flex items-center gap-3">
                                <span class="text-[9px] font-black text-zinc-400 uppercase tracking-widest">Contorno</span>
                                <div class="color-wrapper shadow-lg"><input type="color" id="outline-color" value="#000000" class="color-input"></div>
                            </div>
                        </div>

                        <button id="outline-toggle" class="toggle-btn active justify-center w-full">
                            <i data-lucide="check" class="w-3.5 h-3.5"></i>
                            Stile Contorno Attivo
                        </button>
                    </div>
                </div>
            </div>

            <!-- Bulk Video Queue -->
            <div class="space-y-3 p-4 bg-gradient-to-br from-blue-950/30 to-violet-950/30 rounded-2xl border border-blue-800/30">
                <div class="flex items-center justify-between">
                    <span class="text-[10px] font-black uppercase text-blue-300 tracking-widest">üé¨ Creazione Bulk</span>
                    <div class="flex gap-2 flex-wrap justify-end">
                        <button id="auto-queue-btn" class="px-4 py-2.5 bg-violet-600 hover:bg-violet-500 rounded-xl text-[11px] font-black uppercase transition-all flex items-center gap-2 shadow-lg">
                            <i data-lucide="zap" class="w-4 h-4"></i>
                            Auto-Coda
                        </button>
                        <button id="save-queue-btn" class="px-4 py-2.5 bg-green-600 hover:bg-green-500 rounded-xl text-[11px] font-black uppercase transition-all flex items-center gap-2 shadow-lg hidden">
                            <i data-lucide="save" class="w-4 h-4"></i>
                            Salva
                        </button>
                        <button id="prev-video-btn" class="px-4 py-2.5 bg-zinc-800 hover:bg-zinc-700 rounded-xl text-[11px] font-black uppercase transition-all flex items-center gap-2 disabled:opacity-30">
                            <i data-lucide="chevron-left" class="w-4 h-4"></i>
                            Prev
                        </button>
                        <button id="add-to-queue-btn" class="px-4 py-2.5 bg-blue-600 hover:bg-blue-500 rounded-xl text-[11px] font-black uppercase transition-all flex items-center gap-2 shadow-lg">
                            <i data-lucide="plus" class="w-4 h-4"></i>
                            Aggiungi
                        </button>
                        <button id="next-video-btn" class="px-4 py-2.5 bg-zinc-800 hover:bg-zinc-700 rounded-xl text-[11px] font-black uppercase transition-all flex items-center gap-2 disabled:opacity-30">
                            Next
                            <i data-lucide="chevron-right" class="w-4 h-4"></i>
                        </button>
                    </div>
                </div>
                <div id="queue-list" class="space-y-1 max-h-32 overflow-y-auto"></div>
            </div>

            <div class="grid grid-cols-2 gap-3">
                <button id="export-btn" class="btn-sv text-white font-black py-4 rounded-2xl flex items-center justify-center gap-2 uppercase tracking-widest text-[10px]">
                    <i data-lucide="download" class="w-4 h-4"></i> Esporta Video Singolo
                </button>
                <button id="export-all-btn" class="bg-gradient-to-r from-violet-600 to-blue-600 text-white font-black py-4 rounded-2xl flex items-center justify-center gap-2 uppercase tracking-widest text-[10px] disabled:opacity-50 disabled:cursor-not-allowed hover:from-violet-500 hover:to-blue-500 transition-all">
                    <i data-lucide="download-cloud" class="w-4 h-4"></i> Esporta Tutti (<span id="export-count">0</span>)
                </button>
            </div>
            
            <div id="export-status" class="hidden bg-black border border-zinc-800 p-4 rounded-2xl">
                <div class="flex justify-between text-[10px] mb-2 font-black uppercase text-blue-400">
                    <span id="status-text">Preparazione...</span>
                    <span id="percent-text">0%</span>
                </div>
                <div class="w-full bg-zinc-900 rounded-full h-1.5 overflow-hidden">
                    <div id="progress-bar" class="bg-blue-500 h-full w-0 transition-all"></div>
                </div>
            </div>
        </div>
    </div>

    <audio id="bg-music" crossorigin="anonymous"></audio>
    <canvas id="render-canvas"></canvas>
    <video id="source-video" style="display: none;"></video>

    <script>
        lucide.createIcons();

        const video = document.getElementById('main-video');
        const audio = document.getElementById('bg-music');
        const caption = document.getElementById('caption-overlay');
        const captionElement = document.getElementById('caption-overlay');
        const videoContainer = document.getElementById('drop-zone');
        const vTrimOverlay = document.getElementById('video-trim-overlay');
        const aTrimOverlay = document.getElementById('audio-trim-overlay');
        const vTrimmerTrack = document.getElementById('v-trimmer-track');
        const aTrimmerTrack = document.getElementById('a-trimmer-track');
        const vPlayhead = document.getElementById('video-playhead');
        const aPlayhead = document.getElementById('audio-playhead');
        const canvas = document.getElementById('waveform');
        const ctx = canvas.getContext('2d');

        let videoFile, audioFile;
        let videoDuration = 0, audioDuration = 0;
        let vStart = 0, vEnd = 15;
        let aStart = 0;
        
        const MAX_DUR = 30; 
        
        let outlineEnabled = true;
        let removeWatermark = false;
        let isDraggingV = null; 
        let isDraggingA = false;
        let dragOffsetV = 0;
        let dragOffsetA = 0;

        // File libraries for bulk workflow
        let videoLibrary = [];
        let audioLibrary = [];
        let currentVideoIndex = 0;
        let currentAudioIndex = -1; // -1 means no audio selected

        function updateFileLibraryUI() {
            const videoList = document.getElementById('video-files-list');
            const audioList = document.getElementById('audio-files-list');
            
            if (videoLibrary.length > 0) {
                videoList.innerHTML = `üìÅ ${videoLibrary.length} video caricati`;
                document.getElementById('video-label').innerText = `${videoLibrary.length} video pronti`;
            } else {
                videoList.innerHTML = '';
                document.getElementById('video-label').innerText = 'Carica Video (Multipli)';
            }
            
            if (audioLibrary.length > 0) {
                audioList.innerHTML = `üéµ ${audioLibrary.length} audio caricati`;
                document.getElementById('audio-label').innerText = `${audioLibrary.length} audio pronti`;
                
                // Update audio selector
                const selector = document.getElementById('audio-selector');
                selector.innerHTML = '<option value="">Nessun Audio</option>';
                audioLibrary.forEach((audioFile, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = audioFile.name;
                    selector.appendChild(option);
                });
            } else {
                audioList.innerHTML = '';
                document.getElementById('audio-label').innerText = 'Carica Audio (Multipli)';
            }
        }

        function loadVideoFromLibrary(index) {
            if (index < 0 || index >= videoLibrary.length) return;
            
            currentVideoIndex = index;
            videoFile = videoLibrary[index];
            video.src = URL.createObjectURL(videoFile);
            video.onloadedmetadata = () => {
                videoDuration = video.duration;
                vStart = 0;
                vEnd = Math.min(videoDuration, 15);
                updateTrimmers();
                video.currentTime = vStart;
            };
            generateThumbnails(videoFile);
        }

        function loadAudioFromSelector() {
            const selector = document.getElementById('audio-selector');
            const selectedIndex = parseInt(selector.value);
            
            if (isNaN(selectedIndex) || selectedIndex < 0) {
                // No audio selected
                currentAudioIndex = -1;
                audioFile = null;
                audio.src = '';
                audioDuration = 0;
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                updateTrimmers();
                return;
            }
            
            currentAudioIndex = selectedIndex;
            audioFile = audioLibrary[selectedIndex];
            audio.src = URL.createObjectURL(audioFile);
            audio.onloadedmetadata = () => {
                audioDuration = audio.duration;
                drawWaveform(audioFile);
                updateTrimmers();
                audio.currentTime = aStart;
            };
        }

        // Toggle watermark removal
        document.getElementById('toggle-watermark').onclick = function() {
            removeWatermark = !removeWatermark;
            this.classList.toggle('active');
            
            if (removeWatermark) {
                video.style.transform = 'scale(1.1)';
                this.innerHTML = '<i data-lucide="zoom-out" class="w-3.5 h-3.5"></i> Reset Zoom';
            } else {
                video.style.transform = 'scale(1)';
                this.innerHTML = '<i data-lucide="zoom-in" class="w-3.5 h-3.5"></i> Remove VEO';
            }
            lucide.createIcons();
        };

        function updateTrimmers() {
            if (videoDuration > 0) {
                const vLeft = (vStart / videoDuration) * 100;
                const vWidth = ((vEnd - vStart) / videoDuration) * 100;
                vTrimOverlay.style.left = vLeft + '%';
                vTrimOverlay.style.width = vWidth + '%';
                
                document.getElementById('v-range-text').innerText = `${vStart.toFixed(1)}s - ${vEnd.toFixed(1)}s`;
                document.getElementById('video-dur-label').innerText = `Video: ${(vEnd - vStart).toFixed(1)}s`;
                
                if (audioDuration > 0) {
                    const currentVidDur = vEnd - vStart;
                    const aWidth = (currentVidDur / audioDuration) * 100;
                    
                    if (aStart + currentVidDur > audioDuration) {
                        aStart = Math.max(0, audioDuration - currentVidDur);
                    }
                    
                    const aLeft = (aStart / audioDuration) * 100;
                    aTrimOverlay.style.left = aLeft + '%';
                    aTrimOverlay.style.width = aWidth + '%';
                    document.getElementById('audio-start-label').innerText = `Start Audio: ${aStart.toFixed(1)}s`;
                }
            }
        }

        function loopMonitor() {
            if (!video.paused) {
                if (videoDuration > 0) {
                    const vPerc = (video.currentTime / videoDuration) * 100;
                    vPlayhead.style.left = vPerc + '%';
                    vPlayhead.style.display = 'block';
                }

                if (audio.src && audioDuration > 0) {
                    const aPerc = (audio.currentTime / audioDuration) * 100;
                    aPlayhead.style.left = aPerc + '%';
                    aPlayhead.style.display = 'block';
                }

                if (video.currentTime >= vEnd - 0.05) {
                    video.currentTime = vStart;
                    if (audio.src) {
                        audio.currentTime = aStart;
                        audio.play().catch(() => {});
                    }
                }

                if (audio.src && !audio.paused) {
                    const videoOffset = video.currentTime - vStart;
                    const expectedAudioTime = aStart + videoOffset;
                    if (Math.abs(audio.currentTime - expectedAudioTime) > 0.2) {
                        audio.currentTime = expectedAudioTime;
                    }
                }
            } else {
                vPlayhead.style.display = 'none';
                aPlayhead.style.display = 'none';
            }
            requestAnimationFrame(loopMonitor);
        }
        requestAnimationFrame(loopMonitor);

        vTrimmerTrack.onmousedown = (e) => {
            if (videoDuration === 0) return;
            const rect = vTrimmerTrack.getBoundingClientRect();
            const clickTime = ((e.clientX - rect.left) / rect.width) * videoDuration;
            
            if (e.target.id === 'v-handle-l') {
                isDraggingV = 'left';
            } else if (e.target.id === 'v-handle-r') {
                isDraggingV = 'right';
            } else if (e.target.closest('#video-trim-overlay')) {
                isDraggingV = 'center';
                dragOffsetV = clickTime - vStart;
            } else {
                video.currentTime = clickTime;
                if (audio.src) {
                    const offset = clickTime - vStart;
                    audio.currentTime = Math.max(0, aStart + offset);
                }
            }
        };

        aTrimmerTrack.onmousedown = (e) => {
            if (audioDuration === 0) return;
            const rect = aTrimmerTrack.getBoundingClientRect();
            const clickTime = ((e.clientX - rect.left) / rect.width) * audioDuration;
            
            if (e.target.closest('#audio-trim-overlay')) {
                isDraggingA = true;
                dragOffsetA = clickTime - aStart;
            } else {
                const currentVidDur = vEnd - vStart;
                let newAStart = clickTime - (currentVidDur / 2);
                if (newAStart < 0) newAStart = 0;
                if (newAStart + currentVidDur > audioDuration) newAStart = audioDuration - currentVidDur;
                aStart = newAStart;
                updateTrimmers();
                audio.currentTime = aStart;
                video.currentTime = vStart;
            }
        };

        window.onmousemove = (e) => {
            if (isDraggingV && videoDuration > 0) {
                const rect = vTrimmerTrack.getBoundingClientRect();
                const x = Math.max(0, Math.min(e.clientX - rect.left, rect.width));
                const currentTime = (x / rect.width) * videoDuration;

                if (isDraggingV === 'left') {
                    if (currentTime < vEnd && vEnd - currentTime <= MAX_DUR) vStart = currentTime;
                    else if (vEnd - currentTime > MAX_DUR) vStart = vEnd - MAX_DUR;
                } else if (isDraggingV === 'right') {
                    if (currentTime > vStart && currentTime - vStart <= MAX_DUR) vEnd = currentTime;
                    else if (currentTime - vStart > MAX_DUR) vEnd = vStart + MAX_DUR;
                } else if (isDraggingV === 'center') {
                    let dur = vEnd - vStart;
                    let newStart = currentTime - dragOffsetV;
                    if (newStart >= 0 && newStart + dur <= videoDuration) {
                        vStart = newStart;
                        vEnd = newStart + dur;
                    }
                }
                updateTrimmers();
                syncPlayback();
            }

            if (isDraggingA && audioDuration > 0) {
                const rect = aTrimmerTrack.getBoundingClientRect();
                const x = Math.max(0, Math.min(e.clientX - rect.left, rect.width));
                const currentTime = (x / rect.width) * audioDuration;
                const currentVidDur = vEnd - vStart;
                let newAStart = currentTime - dragOffsetA;
                if (newAStart >= 0 && newAStart + currentVidDur <= audioDuration) {
                    aStart = newAStart;
                }
                updateTrimmers();
                syncPlayback();
            }
        };

        window.onmouseup = () => {
            isDraggingV = null;
            isDraggingA = false;
        };

        document.getElementById('video-input').onchange = async (e) => {
            const files = Array.from(e.target.files);
            if (files.length === 0) return;
            
            if (files.length > MAX_QUEUE_SIZE) {
                alert(`Puoi caricare massimo ${MAX_QUEUE_SIZE} video!`);
                videoLibrary = files.slice(0, MAX_QUEUE_SIZE);
            } else {
                videoLibrary = files;
            }
            
            updateFileLibraryUI();
            
            // Load first video automatically
            if (videoLibrary.length > 0) {
                loadVideoFromLibrary(0);
                
                // Show success notification
                const statusDiv = document.createElement('div');
                statusDiv.className = 'fixed top-4 right-4 bg-blue-500 text-white px-4 py-2 rounded-lg font-bold text-sm z-50';
                statusDiv.innerText = `‚úì ${videoLibrary.length} video caricati!`;
                document.body.appendChild(statusDiv);
                setTimeout(() => statusDiv.remove(), 2000);
            }
        };

        document.getElementById('audio-input').onchange = (e) => {
            const files = Array.from(e.target.files);
            if (files.length === 0) return;
            
            if (files.length > MAX_QUEUE_SIZE) {
                alert(`Puoi caricare massimo ${MAX_QUEUE_SIZE} audio!`);
                audioLibrary = files.slice(0, MAX_QUEUE_SIZE);
            } else {
                audioLibrary = files;
            }
            
            updateFileLibraryUI();
            
            // Show success notification
            const statusDiv = document.createElement('div');
            statusDiv.className = 'fixed top-4 right-4 bg-violet-500 text-white px-4 py-2 rounded-lg font-bold text-sm z-50';
            statusDiv.innerText = `‚úì ${audioLibrary.length} audio caricati!`;
            document.body.appendChild(statusDiv);
            setTimeout(() => statusDiv.remove(), 2000);
        };

        // Audio selector change handler
        document.getElementById('audio-selector').onchange = () => {
            loadAudioFromSelector();
        };

        document.getElementById('play-btn').onclick = () => {
            if (video.paused) {
                video.currentTime = vStart;
                if (audio.src) {
                    audio.currentTime = aStart;
                    audio.play().catch(() => {});
                }
                video.play();
                updatePlayIcon(true);
            } else {
                video.pause();
                audio.pause();
                updatePlayIcon(false);
            }
        };

        function syncPlayback() {
            video.currentTime = vStart;
            if (audio.src) audio.currentTime = aStart;
            if (!video.paused) {
                video.play();
                if (audio.src) audio.play().catch(() => {});
            }
        }

        function updatePlayIcon(isPlaying) {
            const icon = document.getElementById('play-icon');
            icon.setAttribute('data-lucide', isPlaying ? 'pause' : 'play');
            lucide.createIcons();
        }

        async function drawWaveform(file) {
            const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const buffer = await file.arrayBuffer();
            const decoded = await audioCtx.decodeAudioData(buffer);
            const rawData = decoded.getChannelData(0);
            const samples = 120;
            const blockSize = Math.floor(rawData.length / samples);
            const data = [];
            for (let i = 0; i < samples; i++) {
                let sum = 0;
                for (let j = 0; j < blockSize; j++) sum += Math.abs(rawData[i * blockSize + j]);
                data.push(sum / blockSize);
            }
            const max = Math.max(...data);
            canvas.width = canvas.offsetWidth * 2;
            canvas.height = canvas.offsetHeight * 2;
            const step = canvas.width / samples;
            const grad = ctx.createLinearGradient(0, 0, canvas.width, 0);
            grad.addColorStop(0, '#3B82F6');
            grad.addColorStop(1, '#8B5CF6');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = grad;
            data.forEach((val, i) => {
                const h = (val / max) * canvas.height * 0.8;
                const x = i * step;
                const y = (canvas.height - h) / 2;
                ctx.beginPath();
                ctx.roundRect(x, y, step - 3, h, 2);
                ctx.fill();
            });
        }

        document.getElementById('caption-input').oninput = (e) => caption.innerText = e.target.value || 'Scrivi il tuo testo';
        document.getElementById('font-size').oninput = (e) => {
            caption.style.fontSize = e.target.value + 'px';
            document.getElementById('fs-val').innerText = e.target.value + 'px';
        };
        document.getElementById('text-color').oninput = (e) => caption.style.color = e.target.value;
        
        const outlineBtn = document.getElementById('outline-toggle');
        const outlineColorInput = document.getElementById('outline-color');

        function updateOutlineUI() {
            if (outlineEnabled) {
                caption.classList.add('text-bold-outline');
                outlineBtn.classList.add('active');
                outlineBtn.innerHTML = '<i data-lucide="check" class="w-3.5 h-3.5"></i> Stile Contorno Attivo';
            } else {
                caption.classList.remove('text-bold-outline');
                outlineBtn.classList.remove('active');
                outlineBtn.innerHTML = '<i data-lucide="x" class="w-3.5 h-3.5"></i> Stile Contorno Spento';
            }
            lucide.createIcons();
        }

        outlineBtn.onclick = () => {
            outlineEnabled = !outlineEnabled;
            updateOutlineUI();
        };

        outlineColorInput.oninput = (e) => {
            caption.style.setProperty('--outline-color', e.target.value);
            if (!outlineEnabled) {
                outlineEnabled = true;
                updateOutlineUI();
            }
        };

        document.querySelectorAll('.font-btn').forEach(btn => {
            btn.onclick = () => {
                document.querySelectorAll('.font-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                const hasOutline = caption.classList.contains('text-bold-outline');
                caption.className = btn.dataset.font + (hasOutline ? ' text-bold-outline' : '');
            };
        });

        let dragText = false, dragStartY, dragStartTop;
        
        caption.onmousedown = (e) => { 
            dragText = true; 
            dragStartY = e.clientY;
            dragStartTop = caption.offsetTop;
            caption.style.cursor = 'grabbing';
            caption.classList.add('dragging');
            e.preventDefault();
        };
        
        window.addEventListener('mousemove', (e) => {
            if (dragText) {
                const rect = document.getElementById('drop-zone').getBoundingClientRect();
                const deltaY = e.clientY - dragStartY;
                let newTop = dragStartTop + deltaY;
                
                const minTop = 10;
                const maxTop = rect.height - caption.offsetHeight - 10;
                newTop = Math.max(minTop, Math.min(newTop, maxTop));
                
                caption.style.top = newTop + 'px';
            }
        });
        
        window.addEventListener('mouseup', () => {
            if (dragText) {
                dragText = false;
                caption.style.cursor = 'move';
                caption.classList.remove('dragging');
            }
        });

        async function generateThumbnails(file) {
            const container = document.getElementById('v-thumbs');
            container.innerHTML = '';
            const tempVideo = document.createElement('video');
            tempVideo.src = URL.createObjectURL(file);
            tempVideo.muted = true;
            tempVideo.playsInline = true;
            await new Promise(r => tempVideo.onloadedmetadata = r);
            const count = 10;
            const interval = tempVideo.duration / count;
            for (let i = 0; i < count; i++) {
                tempVideo.currentTime = i * interval;
                await new Promise(r => tempVideo.onseeked = r);
                const c = document.createElement('canvas');
                const ratio = tempVideo.videoWidth / tempVideo.videoHeight;
                c.width = 100; c.height = 100 / ratio;
                c.getContext('2d').drawImage(tempVideo, 0, 0, c.width, c.height);
                container.appendChild(c);
            }
            URL.revokeObjectURL(tempVideo.src);
        }

        // Export usando mp4-muxer
        document.getElementById('export-btn').onclick = async () => {
            if (!videoFile) {
                alert('Carica un video prima di esportare!');
                return;
            }

            const exportBtn = document.getElementById('export-btn');
            exportBtn.disabled = true;
            
            const status = document.getElementById('export-status');
            const progress = document.getElementById('progress-bar');
            const statusText = document.getElementById('status-text');
            const percentText = document.getElementById('percent-text');
            
            status.classList.remove('hidden');
            progress.style.width = '0%';
            percentText.innerText = '0%';
            statusText.innerText = 'Inizializzazione...';

            try {
                const sourceVideo = document.getElementById('source-video');
                sourceVideo.src = URL.createObjectURL(videoFile);
                await new Promise(r => sourceVideo.onloadedmetadata = r);

                const renderCanvas = document.getElementById('render-canvas');
                const renderCtx = renderCanvas.getContext('2d');
                
                const targetWidth = 720;
                const targetHeight = 1280;
                
                renderCanvas.width = targetWidth;
                renderCanvas.height = targetHeight;

                const fps = 30;
                const duration = vEnd - vStart;

                statusText.innerText = 'Creazione MP4 muxer...';

                const { Muxer, ArrayBufferTarget } = window.Mp4Muxer;

                const muxerConfig = {
                    target: new ArrayBufferTarget(),
                    video: {
                        codec: 'avc',
                        width: renderCanvas.width,
                        height: renderCanvas.height
                    },
                    fastStart: 'in-memory'
                };

                if (audioFile) {
                    muxerConfig.audio = {
                        codec: 'aac',
                        numberOfChannels: 2,
                        sampleRate: 48000
                    };
                }

                const muxer = new Muxer(muxerConfig);

                statusText.innerText = 'Codifica video...';
                
                const videoEncoder = new VideoEncoder({
                    output: (chunk, meta) => muxer.addVideoChunk(chunk, meta),
                    error: e => {
                        console.error('Video encoder error:', e);
                        throw new Error('Errore di codifica video: ' + e.message);
                    }
                });

                videoEncoder.configure({
                    codec: 'avc1.42001F',
                    width: renderCanvas.width,
                    height: renderCanvas.height,
                    bitrate: 8_000_000,
                    framerate: fps,
                    avc: { format: 'avc' }
                });

                let audioEncoder = null;
                let audioContext = null;
                let audioData = null;

                if (audioFile) {
                    statusText.innerText = 'Preparazione audio...';
                    
                    audioContext = new AudioContext({ sampleRate: 48000 });
                    const audioBuffer = await audioFile.arrayBuffer();
                    const decodedAudio = await audioContext.decodeAudioData(audioBuffer);
                    
                    const startSample = Math.floor(aStart * decodedAudio.sampleRate);
                    const endSample = Math.floor((aStart + duration) * decodedAudio.sampleRate);
                    const sampleCount = endSample - startSample;
                    
                    audioData = {
                        left: new Float32Array(sampleCount),
                        right: new Float32Array(sampleCount),
                        sampleRate: decodedAudio.sampleRate
                    };
                    
                    const leftChannel = decodedAudio.getChannelData(0);
                    const rightChannel = decodedAudio.numberOfChannels > 1 ? decodedAudio.getChannelData(1) : leftChannel;
                    
                    for (let i = 0; i < sampleCount; i++) {
                        audioData.left[i] = leftChannel[startSample + i] || 0;
                        audioData.right[i] = rightChannel[startSample + i] || 0;
                    }

                    audioEncoder = new AudioEncoder({
                        output: (chunk, meta) => muxer.addAudioChunk(chunk, meta),
                        error: e => {
                            console.error('Audio encoder error:', e);
                            throw new Error('Errore di codifica audio: ' + e.message);
                        }
                    });

                    audioEncoder.configure({
                        codec: 'mp4a.40.2',
                        sampleRate: 48000,
                        numberOfChannels: 2,
                        bitrate: 128000
                    });
                }

                sourceVideo.currentTime = vStart;
                await new Promise(r => sourceVideo.onseeked = r);

                const totalFrames = Math.ceil(duration * fps);
                let frameCount = 0;

                const targetSampleRate = 48000;
                const sourceSampleRate = audioData ? audioData.sampleRate : 48000;
                const samplesPerFrame = Math.floor(targetSampleRate / fps);
                let audioSampleOffset = 0;

                // CORREZIONE: Salva la posizione REALE del caption rispetto al video container
                const captionElement = document.getElementById('caption-overlay');
                const videoContainer = document.getElementById('drop-zone');
                
                // Calcola la posizione esatta in pixel relativi al container
                const containerRect = videoContainer.getBoundingClientRect();
                const captionRect = captionElement.getBoundingClientRect();
                
                const captionPosition = {
                    text: captionElement.innerText,
                    // Posizione top relativa al container (in pixel)
                    topPx: captionRect.top - containerRect.top,
                    // Salva anche la larghezza effettiva del caption per mantenere il wrapping
                    maxWidthPx: captionElement.offsetWidth,
                    fontSize: parseInt(captionElement.style.fontSize || '12'),
                    color: captionElement.style.color || '#ffffff',
                    outlineColor: getComputedStyle(captionElement).getPropertyValue('--outline-color') || '#000000',
                    fontClass: captionElement.className,
                    hasOutline: captionElement.classList.contains('text-bold-outline')
                };

                console.log('Caption position saved:', captionPosition);
                console.log('Container height:', containerRect.height);
                console.log('Caption top offset:', captionPosition.topPx);
                console.log('Caption max width:', captionPosition.maxWidthPx);

                for (let i = 0; i < totalFrames; i++) {
                    const timestamp = i / fps;
                    sourceVideo.currentTime = vStart + timestamp;
                    await new Promise(r => sourceVideo.onseeked = r);

                    // Applica zoom se removeWatermark √® attivo
                    if (removeWatermark) {
                        const scale = 1.1;
                        const scaledWidth = sourceVideo.videoWidth * scale;
                        const scaledHeight = sourceVideo.videoHeight * scale;
                        const offsetX = -(scaledWidth - renderCanvas.width) / 2;
                        const offsetY = -(scaledHeight - renderCanvas.height) / 2;
                        
                        renderCtx.drawImage(
                            sourceVideo,
                            offsetX,
                            offsetY,
                            scaledWidth,
                            scaledHeight
                        );
                    } else {
                        renderCtx.drawImage(sourceVideo, 0, 0, renderCanvas.width, renderCanvas.height);
                    }

                    // Draw caption con posizione corretta e word wrapping
                    if (captionPosition.text && captionPosition.text !== 'Scrivi il tuo testo') {
                        // Calcola il scale factor basandosi sull'altezza del container
                        const previewHeight = videoContainer.offsetHeight;
                        const exportHeight = renderCanvas.height;
                        const scaleFactor = exportHeight / previewHeight;
                        
                        const scaledFontSize = captionPosition.fontSize * scaleFactor;
                        const scaledMaxWidth = captionPosition.maxWidthPx * scaleFactor;

                        let fontFamily = 'Montserrat';
                        if (captionPosition.fontClass.includes('font-typewriter')) fontFamily = 'Courier Prime';
                        else if (captionPosition.fontClass.includes('font-classic')) fontFamily = 'Inter';
                        else if (captionPosition.fontClass.includes('font-handwriting')) fontFamily = 'Dancing Script';

                        renderCtx.font = `800 ${scaledFontSize}px ${fontFamily}`;
                        renderCtx.textAlign = 'center';
                        renderCtx.textBaseline = 'top';

                        // Funzione per wrappare il testo su pi√π righe
                        function wrapText(text, maxWidth) {
                            const words = text.split(' ');
                            const lines = [];
                            let currentLine = words[0];

                            for (let i = 1; i < words.length; i++) {
                                const testLine = currentLine + ' ' + words[i];
                                const metrics = renderCtx.measureText(testLine);
                                if (metrics.width > maxWidth) {
                                    lines.push(currentLine);
                                    currentLine = words[i];
                                } else {
                                    currentLine = testLine;
                                }
                            }
                            lines.push(currentLine);
                            return lines;
                        }

                        const lines = wrapText(captionPosition.text, scaledMaxWidth);
                        const lineHeight = scaledFontSize * 1.2; // 1.2 √® simile al line-height: 1.1 del CSS
                        const textY = captionPosition.topPx * scaleFactor;

                        // Disegna ogni riga
                        lines.forEach((line, index) => {
                            const y = textY + (index * lineHeight);
                            
                            if (captionPosition.hasOutline) {
                                renderCtx.strokeStyle = captionPosition.outlineColor;
                                renderCtx.lineWidth = Math.max(scaleFactor * 1.5, 3);
                                renderCtx.lineJoin = 'round';
                                renderCtx.miterLimit = 2;
                                renderCtx.strokeText(line, renderCanvas.width / 2, y);
                            }

                            renderCtx.fillStyle = captionPosition.color;
                            renderCtx.fillText(line, renderCanvas.width / 2, y);
                        });
                    }

                    const videoFrame = new VideoFrame(renderCanvas, {
                        timestamp: (i * 1_000_000) / fps
                    });

                    videoEncoder.encode(videoFrame, { keyFrame: i % 30 === 0 });
                    videoFrame.close();

                    if (audioEncoder && audioData) {
                        const resampleRatio = sourceSampleRate / targetSampleRate;
                        const sourceSamplesNeeded = Math.floor(samplesPerFrame * resampleRatio);
                        
                        const leftChannel = new Float32Array(samplesPerFrame);
                        const rightChannel = new Float32Array(samplesPerFrame);
                        
                        for (let j = 0; j < samplesPerFrame; j++) {
                            const sourceIndex = Math.floor(audioSampleOffset + (j * resampleRatio));
                            if (sourceIndex < audioData.left.length) {
                                leftChannel[j] = audioData.left[sourceIndex];
                                rightChannel[j] = audioData.right[sourceIndex];
                            } else {
                                leftChannel[j] = 0;
                                rightChannel[j] = 0;
                            }
                        }

                        const audioFrame = new AudioData({
                            format: 'f32-planar',
                            sampleRate: targetSampleRate,
                            numberOfFrames: samplesPerFrame,
                            numberOfChannels: 2,
                            timestamp: (i * 1_000_000) / fps,
                            data: new Float32Array([...leftChannel, ...rightChannel])
                        });

                        audioEncoder.encode(audioFrame);
                        audioFrame.close();
                        
                        audioSampleOffset += sourceSamplesNeeded;
                    }

                    frameCount++;
                    const progressPercent = Math.round((frameCount / totalFrames) * 100);
                    progress.style.width = progressPercent + '%';
                    percentText.innerText = progressPercent + '%';

                    if (i % 10 === 0) {
                        await new Promise(r => setTimeout(r, 0));
                    }
                }

                statusText.innerText = 'Finalizzazione MP4...';
                await videoEncoder.flush();
                if (audioEncoder) await audioEncoder.flush();
                muxer.finalize();

                const buffer = muxer.target.buffer;
                const blob = new Blob([buffer], { type: 'video/mp4' });
                
                statusText.innerText = 'Download...';
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'TikTok_Clip.mp4';
                a.click();

                statusText.innerText = 'Completato!';
                percentText.innerText = '100%';
                progress.style.width = '100%';
                
                setTimeout(() => {
                    status.classList.add('hidden');
                    exportBtn.disabled = false;
                }, 2000);

            } catch (e) {
                console.error('Errore durante l\'export:', e);
                statusText.innerText = 'Errore: ' + e.message;
                alert('Errore durante l\'export. Il tuo browser potrebbe non supportare questa funzionalit√†. Prova con Chrome o Edge aggiornati.');
                percentText.innerText = '';
                setTimeout(() => status.classList.add('hidden'), 3000);
                exportBtn.disabled = false;
            }
        };

        document.getElementById('toggle-guide').onclick = () => {
            const g = document.getElementById('safe-guide');
            g.style.display = g.style.display === 'none' ? 'block' : 'none';
        };

        // ============================================
        // BULK VIDEO QUEUE SYSTEM
        // ============================================
        
        const MAX_QUEUE_SIZE = 20;
        let videoQueue = [];
        let currentQueueIndex = -1;

        function updateQueueUI() {
            const queueList = document.getElementById('queue-list');
            const queueCount = document.getElementById('queue-count');
            const exportCount = document.getElementById('export-count');
            const exportAllBtn = document.getElementById('export-all-btn');
            const prevBtn = document.getElementById('prev-video-btn');
            const nextBtn = document.getElementById('next-video-btn');
            
            queueCount.innerText = `Coda: ${videoQueue.length}/20`;
            exportCount.innerText = videoQueue.length;
            exportAllBtn.disabled = videoQueue.length === 0;
            
            if (videoQueue.length === 0) {
                queueList.innerHTML = '<div class="text-center text-zinc-500 text-[10px] py-4">Nessun video in coda</div>';
                prevBtn.disabled = true;
                nextBtn.disabled = true;
            } else {
                queueList.innerHTML = videoQueue.map((item, index) => `
                    <div class="queue-item ${index === currentQueueIndex ? 'active' : ''}" data-index="${index}">
                        <div class="queue-item-info">
                            <div class="queue-item-caption">${index + 1}. ${item.caption || 'Senza testo'}</div>
                            <div class="queue-item-meta">${item.duration.toFixed(1)}s ‚Ä¢ ${item.hasAudio ? 'Con audio' : 'Solo video'}</div>
                        </div>
                        <div class="queue-item-actions">
                            <button class="queue-item-btn load-queue-item" data-index="${index}">
                                <i data-lucide="eye" class="w-3 h-3 text-blue-400"></i>
                            </button>
                            <button class="queue-item-btn delete-queue-item" data-index="${index}">
                                <i data-lucide="trash-2" class="w-3 h-3 text-red-400"></i>
                            </button>
                        </div>
                    </div>
                `).join('');
                
                lucide.createIcons();
                
                // Event listeners per i bottoni
                document.querySelectorAll('.load-queue-item').forEach(btn => {
                    btn.onclick = () => loadQueueItem(parseInt(btn.dataset.index));
                });
                
                document.querySelectorAll('.delete-queue-item').forEach(btn => {
                    btn.onclick = (e) => {
                        e.stopPropagation();
                        deleteQueueItem(parseInt(btn.dataset.index));
                    };
                });
                
                prevBtn.disabled = currentQueueIndex <= 0;
                nextBtn.disabled = currentQueueIndex >= videoQueue.length - 1;
            }
        }

        function captureCurrentState() {
            console.log('captureCurrentState called');
            console.log('videoFile:', videoFile);
            
            if (!videoFile) {
                alert('Carica prima un video!');
                return null;
            }

            try {
                const containerRect = videoContainer.getBoundingClientRect();
                const captionRect = captionElement.getBoundingClientRect();
                
                console.log('Container rect:', containerRect);
                console.log('Caption rect:', captionRect);

                const state = {
                    // Video data
                    videoFile: videoFile,
                    videoFileName: videoFile.name,
                    videoLibraryIndex: currentVideoIndex,
                    vStart: vStart,
                    vEnd: vEnd,
                    duration: vEnd - vStart,
                    
                    // Audio data
                    audioFile: audioFile,
                    audioFileName: audioFile ? audioFile.name : null,
                    audioLibraryIndex: currentAudioIndex,
                    aStart: aStart,
                    hasAudio: !!audioFile,
                    
                    // Caption data
                    caption: captionElement.innerText,
                    captionTopPx: captionRect.top - containerRect.top,
                    captionMaxWidthPx: captionElement.offsetWidth,
                    fontSize: parseInt(captionElement.style.fontSize || '12'),
                    textColor: captionElement.style.color || '#ffffff',
                    outlineColor: getComputedStyle(captionElement).getPropertyValue('--outline-color') || '#000000',
                    fontClass: captionElement.className,
                    hasOutline: captionElement.classList.contains('text-bold-outline'),
                    
                    // Settings
                    removeWatermark: removeWatermark,
                    
                    // Timestamp
                    timestamp: Date.now()
                };
                
                console.log('State created successfully:', state);
                return state;
                
            } catch (error) {
                console.error('Error in captureCurrentState:', error);
                alert('Errore nel catturare lo stato: ' + error.message);
                return null;
            }
        }

        function loadQueueItem(index) {
            if (index < 0 || index >= videoQueue.length) return;
            
            const item = videoQueue[index];
            currentQueueIndex = index;

            // Show SAVE button
            document.getElementById('save-queue-btn').classList.remove('hidden');
            document.getElementById('add-to-queue-btn').classList.add('hidden');
            
            // Restore video
            if (item.videoFile) {
                videoFile = item.videoFile;
                currentVideoIndex = item.videoLibraryIndex || 0;
                video.src = URL.createObjectURL(item.videoFile);
                video.onloadedmetadata = () => {
                    videoDuration = video.duration;
                    vStart = item.vStart;
                    vEnd = item.vEnd;
                    updateTrimmers();
                    video.currentTime = vStart;
                };
                generateThumbnails(item.videoFile);
            }
            
            // Restore audio
            if (item.audioFile) {
                audioFile = item.audioFile;
                currentAudioIndex = item.audioLibraryIndex || -1;
                audio.src = URL.createObjectURL(item.audioFile);
                audio.onloadedmetadata = () => {
                    audioDuration = audio.duration;
                    aStart = item.aStart;
                    drawWaveform(item.audioFile);
                    updateTrimmers();
                };
                
                // Update selector
                const selector = document.getElementById('audio-selector');
                if (currentAudioIndex >= 0) {
                    selector.value = currentAudioIndex;
                }
            } else {
                audioFile = null;
                currentAudioIndex = -1;
                audio.src = '';
                document.getElementById('audio-selector').value = '';
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            }
            
            // Restore caption
            captionElement.innerText = item.caption;
            document.getElementById('caption-input').value = item.caption;
            captionElement.style.fontSize = item.fontSize + 'px';
            document.getElementById('fs-val').innerText = item.fontSize + 'px';
            document.getElementById('font-size').value = item.fontSize;
            captionElement.style.color = item.textColor;
            document.getElementById('text-color').value = item.textColor;
            captionElement.style.setProperty('--outline-color', item.outlineColor);
            document.getElementById('outline-color').value = item.outlineColor;
            
            // Restore font
            const hasOutline = item.hasOutline;
            captionElement.className = item.fontClass;
            outlineEnabled = hasOutline;
            updateOutlineUI();
            
            // Update font buttons
            document.querySelectorAll('.font-btn').forEach(btn => {
                if (item.fontClass.includes(btn.dataset.font)) {
                    document.querySelectorAll('.font-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                }
            });
            
            // Restore watermark setting
            removeWatermark = item.removeWatermark;
            const watermarkBtn = document.getElementById('toggle-watermark');
            if (removeWatermark) {
                video.style.transform = 'scale(1.1)';
                watermarkBtn.classList.add('active');
                watermarkBtn.innerHTML = '<i data-lucide="zoom-out" class="w-3.5 h-3.5"></i> Reset Zoom';
            } else {
                video.style.transform = 'scale(1)';
                watermarkBtn.classList.remove('active');
                watermarkBtn.innerHTML = '<i data-lucide="zoom-in" class="w-3.5 h-3.5"></i> Remove VEO';
            }
            lucide.createIcons();
            
            updateQueueUI();
        }

        function deleteQueueItem(index) {
            videoQueue.splice(index, 1);
            if (currentQueueIndex === index) {
                currentQueueIndex = -1;
            } else if (currentQueueIndex > index) {
                currentQueueIndex--;
            }
            updateQueueUI();
        }

        // Add to queue button
        document.getElementById('add-to-queue-btn').onclick = () => {
            console.log('Add to queue clicked');
            console.log('Current queue length:', videoQueue.length);
            console.log('Video file:', videoFile);
            
            if (videoQueue.length >= MAX_QUEUE_SIZE) {
                alert(`Puoi aggiungere massimo ${MAX_QUEUE_SIZE} video alla coda!`);
                return;
            }
            
            try {
                const state = captureCurrentState();
                console.log('Captured state:', state);
                
                if (!state) {
                    console.log('State is null, aborting');
                    return;
                }
                
                videoQueue.push(state);
                currentQueueIndex = videoQueue.length - 1;
                console.log('Video added to queue. New length:', videoQueue.length);
                
                // Show SAVE, hide ADD
                document.getElementById('save-queue-btn').classList.remove('hidden');
                document.getElementById('add-to-queue-btn').classList.add('hidden');
                
                updateQueueUI();
                
                // Visual feedback
                const btn = document.getElementById('add-to-queue-btn');
                btn.style.transform = 'scale(0.95)';
                setTimeout(() => btn.style.transform = 'scale(1)', 100);
                
                // Success message
                const statusDiv = document.createElement('div');
                statusDiv.className = 'fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg font-bold text-sm z-50';
                statusDiv.innerText = `‚úì Video ${videoQueue.length} aggiunto alla coda!`;
                document.body.appendChild(statusDiv);
                setTimeout(() => statusDiv.remove(), 2000);
                
            } catch (error) {
                console.error('Error adding to queue:', error);
                alert('Errore durante l\'aggiunta alla coda: ' + error.message);
            }
        };

        // Save changes to existing queue item
        document.getElementById('save-queue-btn').onclick = () => {
            if (currentQueueIndex < 0 || currentQueueIndex >= videoQueue.length) return;
            const state = captureCurrentState();
            if (!state) return;
            videoQueue[currentQueueIndex] = state;
            updateQueueUI();
            const btn = document.getElementById('save-queue-btn');
            btn.style.background = '#16a34a';
            btn.innerHTML = '<i data-lucide="check" class="w-4 h-4"></i> Salvato!';
            lucide.createIcons();
            setTimeout(() => {
                btn.innerHTML = '<i data-lucide="save" class="w-4 h-4"></i> Salva';
                lucide.createIcons();
            }, 1500);
        };

        // Navigation buttons
        document.getElementById('prev-video-btn').onclick = () => {
            if (currentQueueIndex > 0) {
                loadQueueItem(currentQueueIndex - 1);
            } else if (videoLibrary.length > 0 && currentVideoIndex > 0) {
                // Navigate to previous video in library
                loadVideoFromLibrary(currentVideoIndex - 1);
            }
        };

        document.getElementById('next-video-btn').onclick = () => {
            if (currentQueueIndex < videoQueue.length - 1) {
                loadQueueItem(currentQueueIndex + 1);
            } else if (videoLibrary.length > 0 && currentVideoIndex < videoLibrary.length - 1) {
                // Navigate to next video in library
                loadVideoFromLibrary(currentVideoIndex + 1);
                
                // Auto-select caption if available
                const randomBtn = document.getElementById('random-caption-btn');
                if (randomBtn) {
                    randomBtn.click();
                }
            }
        };

        // Auto-queue all videos button
        document.getElementById('auto-queue-btn').onclick = async () => {
            if (videoLibrary.length === 0) {
                alert('Carica prima dei video!');
                return;
            }

            const autoQueueBtn = document.getElementById('auto-queue-btn');
            autoQueueBtn.disabled = true;
            autoQueueBtn.innerHTML = '<i data-lucide="loader" class="w-3 h-3 animate-spin"></i> Caricamento...';
            lucide.createIcons();

            for (let i = 0; i < videoLibrary.length && videoQueue.length < MAX_QUEUE_SIZE; i++) {
                // Load video
                currentVideoIndex = i;
                videoFile = videoLibrary[i];
                
                // Wait for video to load
                video.src = URL.createObjectURL(videoFile);
                await new Promise(resolve => {
                    video.onloadedmetadata = () => {
                        videoDuration = video.duration;
                        vStart = 0;
                        vEnd = Math.min(videoDuration, 15);
                        updateTrimmers();
                        resolve();
                    };
                });

                // Assign a different audio to each video (rotating through library)
                if (audioLibrary.length > 0) {
                    const audioIdx = i % audioLibrary.length;
                    currentAudioIndex = audioIdx;
                    audioFile = audioLibrary[audioIdx];
                    audio.src = URL.createObjectURL(audioFile);
                    await new Promise(resolve => {
                        audio.onloadedmetadata = () => {
                            audioDuration = audio.duration;
                            aStart = 0;
                            updateTrimmers();
                            resolve();
                        };
                    });
                    document.getElementById('audio-selector').value = audioIdx;
                }

                // Generate random caption from all available categories (random category per video)
                const allCats = Object.keys(viralCaptions);
                const randomCat = allCats[Math.floor(Math.random() * allCats.length)];
                const captions = viralCaptions[randomCat];
                const randomCaption = captions[Math.floor(Math.random() * captions.length)];
                captionElement.innerText = randomCaption;
                document.getElementById('caption-input').value = randomCaption;

                // Add to queue
                const state = captureCurrentState();
                if (state) {
                    videoQueue.push(state);
                }

                // Small delay for UI update
                await new Promise(r => setTimeout(r, 100));
            }

            currentQueueIndex = videoQueue.length - 1;
            updateQueueUI();

            autoQueueBtn.disabled = false;
            autoQueueBtn.innerHTML = '<i data-lucide="zap" class="w-3 h-3"></i> Auto-Coda';
            lucide.createIcons();

            // Success notification
            const statusDiv = document.createElement('div');
            statusDiv.className = 'fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg font-bold text-sm z-50';
            statusDiv.innerText = `‚úì ${videoQueue.length} video aggiunti alla coda!`;
            document.body.appendChild(statusDiv);
            setTimeout(() => statusDiv.remove(), 3000);
        };

        // Initialize
        updateQueueUI();

        // ============================================
        // END BULK VIDEO QUEUE SYSTEM
        // ============================================

        // Viral Captions System - 18 Categories x 100 Captions
        const viralCaptions = {
            happy: [
                "oggi √® proprio una di quelle giornate üåû","sorrido per nessun motivo e mi fa bene","quando la vita decide di essere buona con te","non vedo l'ora di raccontartelo","questa canzone mi fa stare troppo bene","ho deciso che oggi √® una bella giornata","qualcosa di bello sta succedendo, lo sento","il tipo di musica che ti fa sorridere da soli","mi sveglio e gi√† sono in vibe","giornata perfetta non esiste... e invece","questa energia non la voglio perdere mai","oggi mi sento invincibile fr","non so perch√© ma sono di buonumore pazzesco","questa canzone = felicit√† pura","quando tutto va bene e lo sai","il sole fuori, questa canzone, perfetto","tipo di giorni che vuoi ricordare","mi sento leggero/a e non so spiegarlo","buonumore attivato, nessuno mi ferma","questa √® la mia canzone dell'estate","qualcosa nel petto quando sento questa","quando la vita ti sorride e tu ricambi","oggi ho sorriso senza motivo almeno 10 volte","questa canzone √® una carezza","giorni cos√¨ li voglio per sempre","mi sento bene e basta","questa musica mi fa venir voglia di ballare da solo/a","giornata di quelle che ricorderai","quando sei in vibe e non vuoi scendere","felice di esistere oggi fr","questo ritmo mi ha salvato la giornata","non so da dove viene questo buonumore ma tienitelo","ogni volta che la sento mi si illumina","oggi s√¨, domani si vedr√†","questa canzone √® una dose di serotonina gratis","mi ha messo il sorriso questa","quando il mood √® alle stelle e non sai perch√©","la vita √® bella quando senti questa","ballerei in mezzo alla strada con questa","un buonumore assurdo oggi","tipo di felicit√† tranquilla che fa stare bene","quando capisci che stai bene e basta","questa canzone √® la mia pace","mi sento in un film bello","non ci vuole molto per stare bene, basta questa canzone","oggi il mondo sembra migliore","questa musica √® pura gioia","mi sveglio e la metto, √® un rito","quando sei contento/a e non hai bisogno di motivi","questa canzone e tutto il resto non conta","giorni in cui il sole ti entra dentro","mi fa venire voglia di chiamare le persone che amo","buonumore contagioso, passatelo","quando senti che le cose vanno nel verso giusto","questa canzone mi fa sentire in pace","oggi ho una carica assurda","mi piace di pi√π il mondo quando sento questa","un sorriso stupido ma sincero","quando la musica ti fa sentire a casa","questa vibrazione √® tutto","oggi non ho problemi, solo questa canzone","quando sei in uno stato di grazia","questa √® una di quelle canzoni che cambiano la giornata","energia buona, unisciti","mi sento come in un montaggio cinematografico","questa canzone mi fa ballare anche con gli occhi","quando sei circondato/a da vibrazioni belle","non voglio che questo momento finisca","tipo di felicit√† che vuoi mettere in tasca","questa canzone √® un abbraccio","giornate cos√¨ le collezionerei","mi fa sentire che tutto √® possibile","il tipo di buonumore che si diffonde","questa musica mi fa amare la vita","oggi ho scelto di stare bene","quando la canzone giusta arriva al momento giusto","mi ricarica l'anima","una di quelle giornate magiche","questa canzone vale pi√π di qualsiasi vitamina","quando tutto sembra in ordine","oggi ho ballato da solo/a in cucina","il sorriso che non riesci a nascondere","questa vibrazione mi accompagna tutto il giorno","tipo di musica che ti fa fare saltare i passi","quando senti che stai costruendo qualcosa di bello","questa √® pura felicit√† in una canzone","oggi mi sento il main character di una storia bella","un mood cos√¨ te lo tieni stretto","quando senti questa e ti viene voglia di correre","buonumore totale e non me ne scuso","questa canzone √® il mio reset","oggi ho voglia di tutto","mi fa venire voglia di fare cose belle","quando sei in armonia con il mondo","questa canzone √® la mia colonna sonora happy","giorni come oggi li voglio ogni giorno","sorrido anche mentre scrivo questo","questa musica √® la mia droga (quella buona)"
            ],
            sad: [
                "certi giorni pesano pi√π di altri","questa canzone sa cose che non ho detto a nessuno","mi metti questa e sparisco nei miei pensieri","quando piangi senza capire il perch√©","giorni in cui il silenzio fa troppo rumore","questa mi ha colpita dove fa male","non sono triste, sono solo... stanca/o","quando ascolti una canzone e ti ritrovi","certi momenti non li riesci a spiegare","questa l'ho messa quando non stavo bene e ancora la ascolto","quando manchi a te stesso/a","il tipo di malinconia bella e brutta insieme","questa canzone capisce quello che non riesco a dire","quando la musica fa quello che le parole non possono","mi fa sentire meno sola/o in questa roba","certi brutti momenti hanno le loro canzoni","quando piangi e non sai da dove viene","questa l'ho ascoltata troppe volte di notte","il tipo di tristezza che non sai come spiegare","quando sei stanca/o di fare finta che vada tutto bene","questa canzone √® la colonna sonora di un brutto periodo","giorni in cui ti manca qualcosa che non sai cos'√®","quando la musica ti abbraccia perch√© gli altri non possono","ci sono notti che servono canzoni cos√¨","questa mi ha fatto piangere pi√π di una volta","quando capisci che stai portando troppo peso","il tipo di solitudine che si sceglie","questa canzone mi fa compagnia quando non voglio compagnia","quando sei a pezzi e anche questo √® okay","certe canzoni le ascolti solo quando stai male","questa mi torna in testa nei momenti difficili","quando la tristezza √® elegante","il tipo di notte che dura troppo","questa canzone √® le cose che non ho mai detto","quando ti senti fuori posto ovunque","certe emozioni le vivi solo tu e nessuno capisce","questa l'ascolto quando ho bisogno di piangere","quando manchi alle persone che ami o ti mancano","il tipo di malinconia che fa stare svegli/e","questa canzone sa quanto sono stanca/o","quando ti penti ma non puoi tornare indietro","certe notti passano solo cos√¨","questa mi fa sentire tutte le cose insieme","quando piangi in macchina pensando a niente","il tipo di tristezza che non vuoi condividere","questa canzone √® per i momenti in cui non stai bene","quando sei nel tuo dolore e hai bisogno di musica","certi giorni ti fai forza da sola/o","questa canzone mi fa compagnia nelle notti difficili","quando hai tutto e ti senti vuoto/a lo stesso","il tipo di sentimento che non ha un nome preciso","questa l'ascolto quando non riesco a dormire","quando qualcosa finisce e non sei pronta/o","certi pensieri arrivano solo di sera","questa canzone √® un abbraccio silenzioso","quando stai processando qualcosa di difficile","il tipo di lacrime che non piangi davanti agli altri","questa mi colpisce ogni volta come la prima","quando ti senti piccola/o in un mondo grande","certi momenti di solitudine sono necessari","questa canzone √® il mio sfogo preferito","quando tutto sembra lontano da dove vorresti essere","il tipo di tristezza che passa da sola se le dai spazio","questa l'ascolto quando non so come stare","quando hai bisogno di sentirti capito/a","certe canzoni ti guardano dentro","questa mi ha fatto scendere le lacrime senza volerle trattenere","quando ti manca qualcuno che non dovresti pi√π sentire","il tipo di sentimento che la musica capisce meglio delle parole","questa canzone √® i miei 3 di notte","quando capisci che stare bene richiede tempo","certi dolori sono discreti ma ci sono","questa mi accompagna nei momenti bui","quando sei in lutto di qualcosa che non √® morto","il tipo di blues che ti fa compagnia","questa canzone √® tutti i pianti trattenuti","quando finalmente ti permetti di sentirti male","certi giorni non hai forza e va bene cos√¨","questa la ascolto e mi do il permesso di stare male","quando la malinconia √® dolce amara","il tipo di musica per quando sei stanca/o di essere forte","questa canzone capisce le mie crepe","quando qualcosa si rompe dentro di te","certe notti sono pi√π lunghe delle altre","questa mi fa sentire tutto quello che evito di giorno","quando la tristezza arriva senza preavviso","il tipo di emozione che rimane","questa √® la canzone per i giorni difficili","quando vuoi solo che qualcuno capisca","certi momenti li attraversi da sola/o","questa canzone √® la mia voce quando non ho parole","quando sei al fondo ma stai ancora respirando","il tipo di tristezza che conosci bene ormai","questa mi ha accompagnata in un brutto periodo","quando piangi per le cose giuste","questa canzone √® tutto quello che non riesco a dire ad alta voce"
            ],
            dance: [
                "il mio corpo ha deciso da solo","questa canzone ti fa ballare anche se non vuoi","quando metti questa e le gambe partono","il tipo di ritmo che non riesci a ignorare","questa √® la canzone che fa alzare tutti","quando il beat entra nelle ossa","non so ballare ma con questa non importa","questa √® partita e la stanza √® esplosa","quando senti questa non puoi stare fermo/a","il tipo di musica per cui non serve saper ballare","questa l'ho messa e tutti si sono alzati","quando balli senza pensarci","questa canzone ha preso il controllo del mio corpo","il ritmo che non ti lascia in pace","questa √® per i balletti in cucina alle 2 di notte","quando il drop arriva e non ti appartieni pi√π","questa canzone √® una trappola per le gambe","il tipo di beat che ti cambia il mood in 2 secondi","questa l'ho messa e la serata √® cambiata","quando balli da solo/a e non ti importa","questa √® la canzone da mettere a tutto volume","il beat che ti porta in loop","quando senti questa devi ballare, √® la legge","questa √® la mia canzone da balletto segreto","il tipo di ritmo che fa muovere anche i timidi","questa ha fatto ballare perfetti sconosciuti","quando il groove ti prende senza preavviso","questa canzone √® illegale per i non ballerini","il tipo di musica che fa dimenticare dove sei","questa l'ho messa al party e ha distrutto","quando scatta questa tutti sul pavimento","questa √® nata per far ballare le persone","il beat che aspettavi senza saperlo","quando questa parte la stanza cambia energia","questa canzone fa venire voglia di fare cose","il tipo di ritmo che diventa ossessione","questa l'hanno chiesta tutti dopo il party","quando balli e per un secondo sei un altro/a","questa √® la colonna sonora dei miei balletti","il drop che fa fare saltare tre gradini","questa canzone √® energia pura e ritmo","quando senti questo beat non c'√® altra scelta","questa l'ho messa e le persone hanno smesso di parlare","il tipo di musica che ti fa dimenticare i problemi","questa √® per i balletti improvvisati","quando il ritmo ti fa fare cose che non sapevi fare","questa canzone √® una scusa per muoversi","il tipo di beat che diventa dipendenza","questa l'ho suonata 3 volte di fila","quando questa parte smetti di pensare","questa √® la canzone per quando hai bisogno di sfogarti ballando","il ritmo perfetto per dimenticarsi di tutto","questa canzone ha il potere di rovinare le sedie","quando il corpo prende il sopravvento sulla testa","questa √® la traccia che cambia le serate","il tipo di musica per cui aspetti il drop","questa l'ho sentita e sono partita","quando balli e ti senti libero/a","questa canzone √® ritmo puro","il beat che ti fa fare cose strane col collo","questa √® la mia canzone del momento per i balletti","quando senti questa e non riesci a stare seduto/a","questa √® per chi balla male ma con tutto il cuore","il tipo di ritmo che entra in testa e non esce","questa l'ho ballata da sola in camera alle 23","quando la musica prende il comando","questa canzone √® progettata per far ballare","il drop che stai aspettando dall'inizio","quando questa parte tutti si girano","questa √® la traccia che fa innamorare del ballo","il ritmo che non ti lascia stare in pace","questa canzone ti rapisce letteralmente","quando balli e non pensi a niente altro","questa √® la canzone per i tuoi migliori balletti","il tipo di beat che fa scordare la fatica","questa l'ho messa e qualcuno ha iniziato a ballare da solo","quando senti questo ritmo capisci tutto","questa √® la colonna sonora delle serate","il tipo di musica che crea energie nuove","questa l'ho scoperta e non riesco a smettere","quando il groove √® cos√¨ forte che non puoi resistere","questa canzone √® una festa da sola","il ritmo che ti converte al ballo","questa l'ho ballata davanti allo specchio almeno 20 volte","quando balli male ma con troppa energia","questa √® la canzone che aspettavi","il tipo di beat che ti fa fare domande su te stesso","questa canzone √® il motivo per cui mi alleno","quando questa parte il tuo corpo sa gi√† cosa fare","questa √® per i balletti che nessuno deve vedere","il ritmo che ti fa muovere senza pensare","questa canzone √® puro istinto motorio","quando il drop √® cos√¨ buono che non ci credi","questa l'ho messa e mi sono svegliata/o","il tipo di musica che ti fa venire voglia di fare tutto"
            ],
            chill: [
                "questa canzone √® esattamente quello di cui avevo bisogno","il tipo di musica per stare bene senza fare niente","questa l'ascolto quando ho bisogno di respirare","quando vuoi spegnere il mondo per un po'","questa canzone √® una coperta calda","il mood: steso/a, questa canzone, niente da fare","questa √® la mia colonna sonora del riposo","quando finalmente ti fermi e respiri","questa canzone sa come si fa a stare tranquilli","il tipo di vibe per le domeniche senza piani","questa l'ho messa e mi sono sentito/a subito meglio","quando hai bisogno di musica che non chiede niente","questa canzone √® pace","il tipo di ritmo lento che ti riequilibra","questa √® per le giornate in cui vuoi solo esistere","quando stai bene e non ti serve altro","questa canzone √® il mio momento per me","il vibe per quando hai voglia di niente di specifico","questa l'ascolto mentre guardo dal finestrino","quando la giornata √® finita e sei sopravvissuto/a","questa canzone ti regala 3 minuti di pace","il tipo di musica per chi ha bisogno di pausa","questa √® perfetta per le serate in casa","quando non hai voglia di parlare con nessuno","questa canzone non ti chiede niente in cambio","il tipo di vibe per le mattine lente","questa l'ho messa e il tempo si √® fermato","quando sei in quel posto tra sveglio e addormentato","questa canzone √® il mio reset mentale","il mood per i pomeriggi senza obiettivi","questa √® la mia canzone per staccare","quando hai bisogno di musica tranquilla ma bella","questa canzone √® il mio rifugio","il tipo di chill che non hai bisogno di guadagnarti","questa l'ascolto mentre faccio niente di importante","quando sei in vibe e non vuoi che finisca","questa canzone √® una passeggiata lenta","il tipo di musica per chi vive di momenti quieti","questa √® perfetta per le notti stellate","quando stai bene da solo/a","questa canzone √® la mia dose di tranquillit√†","il vibe per le serate sul divano","questa l'ho messa e ho dimenticato tutto lo stress","quando la musica ti fa sentire okay cos√¨ come sei","questa canzone √® per le pause necessarie","il tipo di ritmo per chi vuole rallentare","questa √® la colonna sonora del mio momento tranquillo","quando hai voglia di niente e hai trovato la canzone giusta","questa canzone √® silenzio ma con il ritmo","il mood che cerchi certi giorni","questa l'ascolto quando voglio essere solo/a con me","quando il corpo chiede di stare fermo/a","questa canzone √® esattamente il mio tipo di pace","il tipo di musica per cucinare da soli","questa √® per i sabati mattina senza fretta","quando sei rilassato/a e il mondo pu√≤ aspettare","questa canzone √® quella che cerco sempre","il vibe per i momenti di non fare niente","questa l'ho messa e mi sono sentita/o a casa","quando hai bisogno di musica che non disturba","questa canzone √® per chi sa godere del silenzio con il suono","il tipo di chill che ti ricarica","questa √® la mia canzone preferita per rilassarmi","quando la vita rallenta e tu la segui","questa canzone non forza niente","il mood: tutto apposto, nessuna fretta","questa l'ascolto mentre mi perdo nei pensieri buoni","quando senti questa non hai bisogno di altro","questa canzone √® il respiro profondo che cercavi","il tipo di musica per i rientri a casa di sera","questa √® per chi ama stare bene senza drammi","quando vuoi musica che ti accompagna, non ti sovrasta","questa canzone √® bassa, bella e basta","il vibe per i momenti di mezzo","questa l'ho scoperta e ora √® la mia chill preferita","quando senti questa puoi smettere di correre","questa canzone √® la mia pausa caff√® sonora","il tipo di tranquillit√† che si ascolta","questa √® per le giornate grigie ma accettabili","quando la musica ti fa sentire in posto sicuro","questa canzone non chiede niente, ti d√† solo pace","il mood per chi sta bene senza che succeda niente di speciale","questa l'ascolto prima di dormire","quando sei a posto e la musica lo sa","questa canzone √® il tuo angolo tranquillo","il vibe per i weekend senza programmi","questa √® la canzone per chi ha imparato a stare con s√©","quando vuoi solo esistere e basta","questa canzone √® la quiete che cercavi","il tipo di musica per il tuo momento di pausa"
            ],
            love: [
                "questa canzone mi fa venire voglia di mandarla a qualcuno","il tipo di musica che ti fa pensare a lui/lei","questa l'ascolto e mi vengono i pensieri di te","quando una canzone dice tutto quello che non riesci a dire","questa √® la colonna sonora di quando mi hai fatto innamorare","mi fa venire voglia di chiamarti senza motivo","questa canzone √® quello che provo ma non so esprimere","il tipo di brano che mandi senza scrivere niente","questa l'ho ascoltata pensando a te per ore","quando la musica capisce il tuo cuore meglio di te","questa canzone √® una dichiarazione d'amore travestita da canzone","il tipo di sentimento che hai quando senti questa","questa mi fa venir voglia di stare con te","quando ascolti una canzone e pensi a una sola persona","questa √® esattamente come mi sento quando ci sei","mi fa pensare a te in modo assurdo","questa canzone √® quello che non riesco a dirti di persona","il tipo di emozione che ti prende quando ami qualcuno","questa l'ho mandata senza scrivere niente e hai capito","quando il cuore batte a tempo con una canzone","questa √® la nostra canzone o almeno dovrebbe esserlo","mi fa venire i brividi e non √® solo la musica","questa canzone parla di noi e non lo sa nessuno","il tipo di amore che questa canzone descrive","questa l'ascolto e mi manchi","quando sei innamorato/a e ogni canzone parla di loro","questa mi fa pensare alle cose belle tra noi","il tipo di sentimento che dura","questa canzone √® il mio amore su disco","mi fa venir voglia di tenerti la mano","questa √® per chi ama qualcuno in silenzio","quando una canzone ti ricorda perch√© ti sei innamorato/a","questa l'ascolto quando mi manchi","il tipo di musica per chi ha trovato la persona giusta","questa canzone √® la nostra storia","mi fa venire voglia di fare cose romantiche","quando senti questa e sai a chi stai pensando","questa √® la canzone che mi ha fatto capire che ti amavo","il tipo di emozione che non passa","questa l'ho messa e ho pensato solo a te","quando l'amore √® silenzioso ma c'√®","questa canzone √® per le persone che ti riempiono","mi fa venire voglia di essere con te adesso","questa √® la canzone per i momenti belli con te","quando senti questa e il cuore fa una cosa strana","questa canzone √® quello che sento ma non dico","il tipo di amore che cambia le canzoni","questa l'ascolto e sorrido per motivi che sai","quando sei innamorato/a e la musica te lo ricorda","questa √® la colonna sonora del mio sentimento","mi fa pensare a tutte le cose belle di te","questa canzone sa di noi","il tipo di feeling che viene da dentro","questa √® per chi ama qualcuno che non sa","quando ascolti questa e vorresti che fosse con te","questa canzone √® il mio cuore che parla","mi fa venire voglia di scriverti un messaggio assurdo","questa √® per le persone che ami e che lo sai","quando la musica descrive esattamente quello che provi","questa canzone √® tutto quello che sento per te","il tipo di amore che questa musica fa venire","questa l'ho messa quando avevo voglia di te","quando sei innamorato/a e ogni cosa ti ricorda a loro","questa √® la canzone che vorrei farti ascoltare","mi fa venire voglia di abbracciarti","questa canzone √® l'amore nella sua forma migliore","il tipo di emozione che non riesci a trattenere","questa l'ascolto quando voglio sentirmi innamorato/a","quando una canzone descrive perfettamente il tuo sentimento","questa √® per chi sta vivendo qualcosa di bello","mi fa pensare che l'amore √® reale","questa canzone √® i momenti che non dimentico","il tipo di amore che non passa","questa √® la colonna sonora di quando ti ho conosciuto","quando senti questa e vuoi mandarlo a quella persona","questa canzone √® una lettera d'amore senza parole","mi fa venir voglia di farti sapere che ci tengo","questa √® la canzone dei nostri momenti belli","quando l'amore √® questo qui","questa canzone mi fa pensare a tutte le ragioni per cui ti voglio bene","il tipo di emozione che la musica porta a galla","questa l'ascolto quando ho bisogno di sentirmi amato/a","quando una canzone ti ricorda perch√© vale la pena amare","questa √® per chi ha trovato la sua persona","mi fa venire voglia di dirti tutto","questa canzone √® amore in forma sonora","il tipo di feeling romantico che non scade","questa √® la canzone che descrive noi meglio di qualsiasi cosa"
            ],
            pov: [
                "pov: sei nel mio head 24/7","pov: stai pensando a quella persona alle 2 di notte","pov: la giornata √® andata storta ma hai trovato questa canzone","pov: stai guidando da sola/o di notte e tutto √® perfetto","pov: finalmente stai andando verso quello che vuoi","pov: ti sei svegliato/a e per una volta stai bene","pov: hai lasciato andare qualcosa che ti pesava","pov: stai costruendo la versione migliore di te","pov: sei nel momento prima che tutto cambi","pov: la tua playlist capisce te meglio degli altri","pov: stai camminando e la citt√† sembra tua","pov: √® l'estate e hai tutto davanti","pov: ti rendi conto che stai bene da sola/o","pov: stai per fare qualcosa di coraggioso","pov: sei nel tuo personaggio preferito in questo momento","pov: la vita ha finalmente senso","pov: stai vivendo il tuo film personale","pov: hai deciso di non curiartene pi√π","pov: sei nel tuo glow up e lo senti","pov: questa canzone √® la tua firma sonora","pov: stai tornando a casa dopo tanto tempo","pov: hai capito chi sei davvero","pov: stai vivendo il tuo momento migliore senza saperlo","pov: hai smesso di aspettare il permesso","pov: sei nel tuo angolo del mondo e stai bene","pov: la giornata era brutta ma questa canzone l'ha salvata","pov: stai per iniziare qualcosa di nuovo","pov: hai trovato la tua canzone dell'anno","pov: sei esattamente dove dovresti essere","pov: stai per diventare la persona che volevi essere","pov: finalmente hai smesso di scusarti per chi sei","pov: stai guardando fuori dal finestrino con questa canzone","pov: sei il personaggio principale della tua storia","pov: hai fatto qualcosa di cui sei fiera/o","pov: stai ballando da sola/o e non ti importa di niente","pov: la vita sembra un film bello","pov: hai scelto te stesso/a per una volta","pov: stai vivendo uno di quei momenti che ricorderai","pov: hai trovato il ritmo della tua vita","pov: sei in pace con te stesso/a","pov: stai attraversando qualcosa e ce la stai facendo","pov: questa canzone ti descrive perfettamente","pov: stai iniziando il tuo chapter migliore","pov: sei nel momento di transizione tra prima e dopo","pov: hai smesso di preoccuparti di quello che pensano","pov: stai vivendo esattamente come vuoi","pov: ti senti invincibile per la prima volta da tanto","pov: sei nel tuo stato di grazia","pov: stai per fare la cosa pi√π coraggiosa della tua vita","pov: hai finalmente capito cosa vuoi","pov: stai andando verso casa e la vita √® bella","pov: sei nella tua era migliore","pov: hai lasciato andare quello che non ti serviva","pov: stai costruendo qualcosa che conta","pov: ti sei svegliato/a con questa canzone in testa","pov: sei al sicuro e puoi respirare","pov: stai per cambiare tutto in meglio","pov: questa canzone √® il tuo momento","pov: hai scelto il coraggio al posto della paura","pov: stai vivendo il tuo sogno silenzioso","pov: sei nel tuo momento di massima versione","pov: hai finalmente smesso di aspettare","pov: stai guardando indietro e capisci perch√© √® successo tutto","pov: sei nel tuo personale glow up era","pov: hai trovato la canzone che ti rappresenta","pov: stai per iniziare la parte migliore","pov: sei nel mezzo della tua storia pi√π bella","pov: hai deciso che basta con le scuse","pov: stai vivendo slow e bene","pov: questa canzone √® il tuo momento di silenzio potente","pov: sei esattamente dove devi essere","pov: stai diventando chi volevi essere da piccolo/a","pov: hai il controllo della tua vita finalmente","pov: stai attraversando tutto con questa canzone","pov: sei nel tuo capitolo nuovo","pov: hai lasciato andare e finalmente respiri","pov: stai per fare la mossa giusta","pov: sei nella stagione della tua vita pi√π bella","pov: hai tutto davanti e lo sai","pov: stai vivendo il momento che aspettavi","pov: sei nel tuo flusso e nessuno ti ferma","pov: hai imparato da tutto e ora vai avanti","pov: stai scrivendo la tua storia migliore","pov: sei nel posto giusto al momento giusto","pov: hai scelto di stare bene e ci stai riuscendo","pov: stai costruendo la vita che vuoi","pov: sei nella tua era golden","pov: questa canzone √® la tua colonna sonora personale","pov: hai smesso di limitarti","pov: stai per fare qualcosa di importante per te","pov: sei nel tuo momento di essere pienamente te stesso/a","pov: stai vivendo ogni secondo di questa canzone","pov: hai trovato il tuo ritmo nella vita"
            ],
            gym: [
                "questa canzone nel 4¬∞ set quando vuoi mollare","il tipo di brano che ti fa fare 2 rep in pi√π","questa mi ha fatto finire l'allenamento quando non volevo","quando metti questa e di colpo hai energia","questa √® la mia pre-workout pi√π efficace","il ritmo che ti fa dimenticare la fatica","questa l'ascolto e le gambe partono","quando stai per mollare e arriva il drop","questa canzone √® la mia benzina in palestra","il tipo di musica che non ti fa vedere il tempo passare","questa √® per l'ultimo set quando sei a pezzi","quando il beat ti d√† la forza che non pensavi di avere","questa canzone mi ha salvato pi√π di un allenamento","il tipo di ritmo per chi si allena da soli","questa √® la mia canzone per i momenti duri","quando stai soffrendo ma la musica ti porta avanti","questa √® la colonna sonora dei progressi","il tipo di brano che ti fa sentire inarrestabile","questa l'ho messa e ho fatto il mio personal best","quando la musica √® l'unica cosa che ti fa andare avanti","questa canzone √® l'energia che cercavo","il tipo di beat per chi non si arrende","questa √® per i giorni che non vuoi allenarti ma lo fai","quando senti questa sai che l'allenamento sar√† duro","questa canzone √® il mio alleato in palestra","il tipo di musica che ti fa superare te stesso/a","questa l'ascolto e smetto di sentire i muscoli bruciare","quando il ritmo si sincronizza con le tue reps","questa √® per chi si allena in silenzio e fa rumore con i risultati","il tipo di brano che ti fa spingere oltre","questa canzone √® la mia forza supplementare","quando hai voglia di mollare tutto e poi parte questa","questa √® la canzone dell'ultimo sprint","il beat che ti fa andare avanti anche quando non puoi","questa l'ho messa e ho finito l'allenamento con un sorriso","quando la musica √® l'unico coach che ti capisce","questa canzone √® motivazione pura in forma sonora","il tipo di ritmo per i guerrieri silenziosi","questa √® per gli allenamenti alle 6 di mattina","quando stai costruendo qualcosa di fisico e mentale","questa canzone mi d√† la carica che non ho","il tipo di beat che fa venire voglia di sudare","questa l'ascolto quando devo fare le cose difficili","quando il drop arriva nell'ultimo set","questa √® la mia canzone per non mollare","il tipo di musica per chi si allena per s√©, non per gli altri","questa canzone √® la differenza tra il mediocre e il grande","quando senti questa il corpo capisce","questa √® per i progressi lenti ma costanti","il tipo di ritmo che non ti d√† tregua","questa canzone √® il mio secondo respiro","quando stai per arrenderti e la musica dice no","questa l'ho messa e ho superato il mio limite","il tipo di brano per chi sa quanto costano i risultati","questa √® la canzone per i momenti di massimo sforzo","quando il beat ti ricorda perch√© hai iniziato","questa canzone √® l'allenamento invisibile","il tipo di musica per chi fa sacrifici ogni giorno","questa l'ascolto e mi ricordo il mio obiettivo","quando la fatica √® dolce perch√© sai dove stai andando","questa √® per i warrior che nessuno vede","il tipo di ritmo che costruisce campioni","questa canzone √® la motivazione che non scade","quando senti questa e capisci che puoi di pi√π","questa √® la mia canzone per i giorni difficili in palestra","il tipo di beat che non ti lascia scuse","questa l'ho messa nell'allenamento pi√π duro e ho vinto","quando la musica fa quello che i pre-workout non fanno","questa canzone √® puro istinto di sopravvivenza sportiva","il tipo di ritmo per chi sa cosa vuole","questa √® per chi si allena anche quando nessuno guarda","quando senti questo beat entri in zona","questa canzone √® il motivo per cui non salto l'allenamento","il tipo di musica che fa diventare grandi le persone piccole","questa l'ascolto per ricordarmi chi voglio diventare","quando il corpo cede ma la mente no, questa canzone","questa √® la mia arma segreta in allenamento","il tipo di beat per le sessioni che contano davvero","questa canzone √® la differenza tra fermarsi e andare avanti","quando stai facendo cose dure per cose migliori","questa √® per l'atleta che sei dentro anche se non lo sembri","il tipo di ritmo che alimenta l'ambizione","questa canzone √® i miei allenamenti condensati in un brano","quando il sudore vale ogni goccia","questa √® per chi costruisce qualcosa ogni giorno","il tipo di musica per chi non cerca alibi","questa canzone √® la mia spinta nei momenti zero","quando finisci l'allenamento con questa sai di aver fatto tutto"
            ],
            energy: [
                "questa canzone mi ha riacceso","il tipo di beat che ti fa saltare due gradini","questa √® per quando hai bisogno di energia istantanea","quando questa parte il tuo mood cambia di 180 gradi","questa canzone √® una scossa elettrica","il tipo di musica che non ti lascia stare seduto/a","questa l'ho messa e sono partita/o","quando il drop arriva e tu vai","questa √® la canzone per quando hai voglia di fare tutto","il beat che ti risveglia anche il luned√¨ mattina","questa canzone √® benzina pura","quando senti questa e il corpo si attiva da solo","questa √® per i giorni in cui sei in modalit√† ANDIAMO","il tipo di energia che questa canzone porta","questa l'ho ascoltata e ho fatto 3 cose che rimandavo","quando la musica ti d√† la spinta che non trovi altrove","questa canzone √® adrenalina in forma sonora","il tipo di ritmo che non perdona","questa √® la mia canzone per quando devo essere al 100%","quando hai zero energy e poi metti questa","questa canzone risveglia qualcosa","il tipo di beat per quando devi spaccare","questa √® per le giornate in cui sei in modalit√† beast","quando senti questo drop sai che √® il momento","questa canzone √® il mio upgrade di energia","il tipo di musica che ti fa dimenticare la stanchezza","questa l'ho messa e sono diventato/a un'altra persona","quando il beat √® cos√¨ potente che non puoi ignorarlo","questa √® la canzone per le missioni impossibili","il tipo di energia esplosiva che cercavi","questa canzone non ti lascia scuse","quando senti questa sei pronto/a per qualsiasi cosa","questa √® per i momenti in cui devi essere a fuoco","il tipo di ritmo che ti fa venire voglia di correre","questa canzone √® un concentrato di potenza","quando la musica diventa il tuo carburante","questa √® la mia canzone per fare le cose grandi","il tipo di beat che attiva il modalit√† warrior","questa l'ho ascoltata prima di fare qualcosa di coraggioso","quando senti questa e sai che puoi farcela","questa canzone √® energia pura senza filtri","il tipo di musica per chi non si ferma","questa √® per le giornate in cui si fa la storia","quando il drop ti d√† quello che cercavi","questa canzone ha il potere di cambiarti il mood","il tipo di ritmo per le persone che non mollano","questa l'ho messa quando avevo bisogno di tutto","quando la musica fa quello che il caff√® non fa","questa √® la canzone per i momenti di svolta","il tipo di energia radioattiva di questa canzone","questa l'ascolto quando devo essere inarrestabile","quando senti questo beat entri in zona di fuoco","questa canzone √® il suono del potenziale illimitato","il tipo di musica per chi fa cose impossibili","questa √® per i momenti in cui devi esplodere","quando la canzone diventa parte della tua forza","questa canzone √® la mia carica massima","il tipo di beat che non ti d√† spazio per le scuse","questa l'ho ascoltata e ho fatto quello che avevo paura di fare","quando senti questa sai che oggi √® il giorno","questa √® la canzone per chi non conosce il limite","il tipo di energia che questa musica inietta","questa l'ho messa e sono partito/a a tutto gas","quando il ritmo √® cos√¨ buono che diventi invincibile","questa canzone √® il tuo secondo vento","il tipo di beat per i guerrieri di ogni giorno","questa √® per le giornate in cui dai il massimo","quando la musica ti ricorda di cosa sei capace","questa canzone √® potenza, velocit√† e fuoco","il tipo di ritmo per chi vuole spaccare tutto","questa l'ho ascoltata e ho superato il mio limite","quando il drop √® cos√¨ potente che ti alza da terra","questa √® la canzone per i momenti che contano","il tipo di energia inesauribile di questo beat","questa l'ho messa e ho fatto cose che non pensavo","quando senti questa hai tutto quello che ti serve","questa canzone √® l'esplosione controllata che cercavi","il tipo di musica per chi scrive la propria storia","questa √® per i giorni in cui sei al massimo del tuo potenziale","quando la musica diventa una forza della natura","questa canzone √® il mio stato di massima potenza"
            ],
            party: [
                "questa canzone ha iniziato la festa da sola","il tipo di brano che fa alzare tutti in 3 secondi","questa l'ho messa e la serata √® diventata un'altra cosa","quando senti questa al party e vai in trance","questa √® la canzone che tutti aspettavano senza saperlo","il ritmo che trasforma qualsiasi posto in club","questa l'ha messa il dj e siamo esplosi","quando questa parte tutti smettono di parlare e iniziano a ballare","questa canzone √® il segreto delle serate","il tipo di beat che fa ballare anche i timidi","questa √® la nostra canzone di questa estate","quando la senti e sai che la serata sta per iniziare davvero","questa canzone ha fatto ballare perfetti sconosciuti","il tipo di energia che si crea quando parte questo pezzo","questa √® partita e la stanza ha cambiato frequenza","quando il dj mette questa e sai che √® lui il migliore","questa canzone √® la scusa per fare le cose","il tipo di ritmo che unisce tutti sul pavimento","questa l'hanno chiesta 4 volte di fila","quando tutti iniziano a cantarla insieme senza saperla","questa √® la canzone della serata, punto","il tipo di momento che ricorderai tra 10 anni","questa √® partita e nessuno √® rimasto seduto","quando la musica crea quell'energia collettiva","questa canzone fa venire voglia di stare con le persone","il tipo di beat per le notti che durano fino all'alba","questa l'ho sentita al party e l'ho cercata per una settimana","quando senti questa e la vita √® bella","questa √® la colonna sonora delle serate migliori","il ritmo che fa diventare tutti migliori amici","questa canzone √® la festa che non finisce","quando la senti fuori e ti ricorda quella sera","questa √® per le notti che non dimentichi","il tipo di musica che fa venire voglia di stare svegli","questa l'ha messa qualcuno e ha salvato la serata","quando il beat √® cos√¨ buono che non puoi stare fermo/a","questa canzone √® energia collettiva","il tipo di ritmo che fa venire voglia di abbracciare tutti","questa √® la canzone per i momenti epici","quando tutti cantano insieme senza accordarsi","questa canzone fa dimenticare tutto il resto","il tipo di beat che fa durare le serate pi√π a lungo","questa l'hanno ballata tutti, anche quelli che non ballano","quando la musica diventa il ricordo di una serata speciale","questa √® per le serate in cui succede tutto","il tipo di canzone che finisce ed √® silenzio e poi tutti urlano","questa l'ho sentita per la prima volta ad un party e non me la tolgo dalla testa","quando senti questa sai che sei al posto giusto","questa canzone √® la ricetta della serata perfetta","il tipo di ritmo per le notti senza fine","questa √® la canzone che fa venire la pelle d'oca dal ritmo","quando tutti iniziano a ballare nello stesso momento","questa canzone √® coesione in forma sonora","il tipo di musica che crea memoria collettiva","questa l'ho ballata con sconosciuti e sembravamo amici da sempre","quando la serata era finita ma questa ha fatto ricominciare tutto","questa √® la canzone del weekend","il tipo di energy che si crea solo di notte con le persone giuste","questa √® partita al momento giusto e tutto si √® fermato","quando il ritmo entra e tutti si sincronizzano","questa canzone √® il motivo per cui esci","il tipo di beat che fa venire voglia di gridare di felicit√†","questa l'ho sentita e ho capito che la serata stava per diventare leggendaria","quando senti questa ti ricordi perch√© ami la musica dal vivo","questa √® la canzone che tutti vogliono ma non sanno come si chiama","il tipo di notte che questa canzone descrive perfettamente","questa √® per le serate che ti ricordi per anni","quando la musica e le persone giuste si combinano","questa canzone √® la serata migliore condensata in un brano","il tipo di ritmo che fa volere ancora","questa l'ho ballata e mi sentivo invincibile","quando senti questa e la vita ha senso","questa √® la canzone per i momenti di pura gioia collettiva","il tipo di beat per chi ama vivere la notte","questa √® partita e il posto era irriconoscibile","quando tutti cantano la stessa canzone senza averla concordata","questa canzone √® il collante della serata","il tipo di ritmo per le notti perfette","questa √® per chi sa apprezzare le serate vere","quando la musica fa sentire tutti parte di qualcosa","questa canzone √® la sera che tutti aspettano"
            ],
            viral: [
                "questa canzone √® ovunque e capisco perch√©","il tipo di brano che senti e devi cercarlo subito","questa √® diventata virale per un motivo","quando senti questa per la prima volta e sai gi√† che esplode","questa canzone sta prendendo il controllo di tutti","il tipo di ritmo che finisce in tutti i reel","questa √® la canzone del momento e non a caso","quando tutti la usano e ha ancora senso","questa canzone ha colpito qualcosa di universale","il tipo di beat che si riconosce subito","questa √® la canzone che vedi ovunque e non ti stanca mai","quando una canzone cattura lo zeitgeist perfettamente","questa canzone √® diventata un movimento","il tipo di brano che diventa cultura","questa √® nella testa di tutti in questo momento","quando senti questa e capisci perch√© funziona","questa canzone ha qualcosa che le altre non hanno","il tipo di ritmo che diventa meme nel senso migliore","questa √® la canzone che tutti stanno usando e hanno ragione","quando una canzone √® ovunque e tu la ami","questa canzone ha il tocco magico del virale","il tipo di musica che unisce generazioni diverse","questa √® partita e non si ferma pi√π","quando capisci perch√© tutti ne parlano","questa canzone √® il momento culturale che stavamo aspettando","il tipo di beat che fa fare tendenza","questa √® l'inno del periodo e lo sar√† sempre","quando senti questa e vuoi subito condividerla","questa canzone ha la formula giusta","il tipo di ritmo che fa reagire le persone","questa √® la colonna sonora di questo momento storico","quando una canzone cattura qualcosa di reale","questa canzone √® ovunque perch√© merita","il tipo di musica che crea conversazioni","questa √® la canzone che si ricorder√† di questo anno","quando il viral √® giustificato al 100%","questa canzone ha fatto qualcosa a tutti","il tipo di beat che diventa inno involontario","questa √® partita e non riesco a toglierla","quando tutti usano la stessa canzone e non stufa mai","questa canzone tocca qualcosa di comune a tutti","il tipo di ritmo che sa cosa la gente vuole","questa √® la canzone che senti dal niente e ti ferma","quando un brano diventa parte della cultura pop istantaneamente","questa canzone √® il fenomeno del momento","il tipo di musica che non ha bisogno di spiegazioni","questa √® entrata nella cultura collettiva definitivamente","quando senti questa e capisci il potere della musica","questa canzone √® la risposta a qualcosa che non sapevo di cercare","il tipo di beat che riconosci da 2 note","questa √® la canzone di tutti adesso","quando un brano supera i generi e le generazioni","questa canzone √® ovunque e ci fa bene","il tipo di ritmo che fa scattare qualcosa in tutti","questa √® la canzone virale ma per le ragioni giuste","quando tutti la cantano e tu gi√† la conosci da prima","questa canzone √® il momento che stavamo vivendo in forma sonora","il tipo di musica che fa capire perch√© esiste TikTok","questa √® partita e stava scritto nel suo DNA","quando senti questa capisci cosa significa impatto","questa canzone ha creato il suo universo","il tipo di beat che fa venire voglia di ballare e piangere insieme","questa √® la canzone che ha smesso di essere solo musica","quando un brano diventa parte di come racconti questo periodo","questa canzone √® il prodotto perfetto di questo momento","il tipo di ritmo che fa scala globale","questa √® la canzone che ha segnato questa stagione","quando tutti la sanno e la amano e non se ne parla abbastanza","questa canzone √® pura connessione umana","il tipo di musica che fa andare oltre le piattaforme","questa √® partita sui reel e √® finita nei cuori","quando senti questa e vuoi mandarlo a tutti","questa canzone ha un effetto che nessuno sa spiegare","il tipo di beat per cui esiste la condivisione","questa √® la canzone del momento e anche di domani","quando un brano cattura qualcosa di eterno travestito da virale","questa canzone √® il fenomeno che non stanca mai","il tipo di ritmo che rimane dopo che il trend passa","questa √® per chi ama la musica che fa cose vere","quando senti questa e non riesci a non condividerla","questa canzone √® il segreto di questo periodo","il tipo di musica che fa storia mentre la stai vivendo","questa √® la canzone che tutti hanno sentito ma non dimenticano"
            ],
            beauty: [
                "questa canzone √® la colonna sonora del mio getting ready","il tipo di musica per quando ti stai preparando","questa l'ascolto mentre mi trucco e divento un'altra","quando metti questa e il makeup viene meglio","questa canzone √® il mio ritual di bellezza","il tipo di ritmo per le mattine davanti allo specchio","questa √® la mia canzone per sentirmi bella/o","quando senti questa e la cura di s√© diventa magica","questa canzone √® il mio momento di skincare","il tipo di musica per i rituali di bellezza","questa √® la colonna sonora del mio self care","quando questa parte mi sento pronta/o per tutto","questa canzone √® per quando ti vuoi bene","il tipo di beat per i momenti di cura","questa l'ascolto mentre mi preparo e cambia tutto","quando la musica trasforma il getting ready in un momento speciale","questa canzone √® il mio inno al prendersi cura","il tipo di ritmo per chi sa quanto vale","questa √® la canzone per i momenti in cui ti senti splendida/o","quando senti questa e capisci che la bellezza √® uno stato mentale","questa canzone √® per i rituali di cura quotidiani","il tipo di musica per chi si tratta bene","questa l'ascolto davanti allo specchio e mi piaccio di pi√π","quando la musica ti fa sentire pi√π te stesso/a","questa √® la canzone del mio momento di pace quotidiano","il tipo di beat per chi investe in s√©","questa canzone √® il mio momento solo mio","quando ti prendi cura di te con questa musica","questa √® per i momenti in cui sei fiero/a di te","il tipo di ritmo per i giorni in cui ti senti al meglio","questa canzone √® la colonna sonora del mio glow up","quando senti questa e ti senti invincibile davanti allo specchio","questa √® per chi sa che la cura di s√© √® un atto d'amore","il tipo di musica per le serate di self care","questa l'ascolto e mi ricordo di valere","quando la bellezza diventa il tuo momento meditativo","questa canzone √® per chi si tratta come si merita","il tipo di ritmo per i rituali che ti ricaricano","questa √® la mia canzone per iniziare bene la giornata","quando il getting ready diventa una celebrazione","questa canzone √® il mio manifesto della cura","il tipo di musica che ti fa sentire a posto con te","questa l'ascolto e mi sento nel mio skin","quando la musica amplifica il tuo momento di bellezza","questa √® per chi sa che piacersi a s√© viene prima","il tipo di beat per i momenti sacri del self care","questa canzone √® il mio posto sicuro quotidiano","quando senti questa e il mundo fuori non esiste","questa √® la canzone dei miei rituali preferiti","il tipo di ritmo per chi si mette sempre al primo posto","questa l'ascolto e smetto di essere critica/o con me stessa/o","quando la musica ti ricorda quanto sei speciale","questa canzone √® per i momenti di grazia personale","il tipo di musica per le serate in cui ti coccoli","questa √® la colonna sonora del mio amore per me stessa/o","quando senti questa ti senti degna/o di tutto il bello","questa canzone √® il mio inno al self love","il tipo di beat per chi sa che cura = amore","questa l'ascolto e mi sento bella/o senza filtri","quando la musica trasforma la routine in rituale","questa √® per i momenti in cui ti senti in armonia","il tipo di ritmo per chi si accetta","questa canzone √® il mio momento di connessione con me","quando senti questa ti ricordi di prendertene cura","questa √® la canzone dei miei momenti pi√π autentici","il tipo di musica per chi ama s√© profondamente","questa l'ascolto e sono solo io e me stesso/a","quando la bellezza diventa la tua meditazione","questa canzone √® per i rituali che ti fanno stare bene","il tipo di beat per le serate in cui ti vuoi bene tanto","questa √® la mia canzone per i momenti di cura totale","quando senti questa sai che stai investendo in te","questa canzone √® il sound del mio self care","il tipo di ritmo per chi sa che il benessere √® una priorit√†","questa l'ascolto e mi piacere per come sono","quando la musica amplifica l'amore che hai per te","questa √® per chi crede che prendersi cura sia rivoluzionario","il tipo di musica per i momenti di pura autoaccettazione","questa canzone √® il mio momento di essere io","quando senti questa e finalmente stai bene nella tua pelle","questa √® la colonna sonora di chi si ama davvero"
            ],
            sensual: [
                "questa canzone √® pericolosamente bella","il tipo di ritmo che abbassa la voce","questa manda un segnale chiaro senza parole","quando metti questa e l'aria cambia","questa canzone √® tensione pura","il tipo di beat che rallenta tutto","questa l'ascolto e mi sento un'altra persona","quando senti questa e vuoi avvicinarti","questa canzone sa cose","il tipo di musica che dice tutto senza dire niente","questa √® la canzone per il momento giusto","quando il ritmo ti ipnotizza piano piano","questa canzone √® un invito silenzioso","il tipo di beat che crea atmosfera da solo","questa l'ho messa e la stanza √® cambiata","quando senti questa e il tempo rallenta","questa √® per i momenti di massima intensit√†","il tipo di ritmo che non ha bisogno di parole","questa canzone √® magnetismo in forma sonora","quando la musica diventa la protagonista del momento","questa √® la canzone che dice senza dire","il tipo di beat per le serate con le luci basse","questa l'ascolto e mi perdo","quando il groove √® cos√¨ buono che ti strega","questa canzone √® quello che succede tra le righe","il tipo di musica per i momenti di fuoco basso","questa √® la colonna sonora delle tensioni belle","quando senti questa e non riesci a ignorarla","questa canzone √® la versione musicale dell'attrazione","il tipo di ritmo che ti fa rallentare il respiro","questa √® per i momenti che non si raccontano","quando la musica diventa complicit√†","questa canzone sa creare un universo privato","il tipo di beat che fa voglia di avvicinarsi","questa l'ascolto quando voglio sentirti vicino/a","quando il ritmo √® cos√¨ bello che ti incanta","questa √® la canzone per i momenti intensi","il tipo di musica che crea memoria sensoriale","questa √® bella e pericolosa insieme","quando senti questa e perdi il filo del discorso","questa canzone √® elettricit√† controllata","il tipo di beat per le notti silenziose ma accese","questa l'ho messa e abbiamo smesso di parlare","quando la musica diventa atmosfera totale","questa √® per i momenti in cui le parole sono troppe","il tipo di ritmo che fa venire i brividi buoni","questa canzone √® un gioco","quando senti questa e sai gi√† come finisce la serata","questa √® la canzone dei momenti non raccontabili","il tipo di musica che ti prende da dentro","questa l'ascolto quando voglio sentire tutto","quando il groove ti cattura e non ti lascia","questa canzone √® sensazione pura","il tipo di beat che fa abbassare la guardia","questa √® per chi ama le cose intense e belle","quando la musica dice quello che vuoi dire tu","questa canzone √® un codice privato","il tipo di ritmo per i momenti sospesi","questa l'ho messa e il momento √® diventato perfetto","quando senti questa e ti senti desiderabile","questa √® la canzone che crea l'atmosfera giusta","il tipo di musica per i momenti di massima connessione","questa l'ascolto quando voglio dimenticare tutto il resto","quando il beat √® cos√¨ morbido che ti ci avvolgi","questa canzone √® per i momenti di bellezza intensa","il tipo di ritmo che parla alla pelle","questa √® la colonna sonora dei momenti che non dimentichi","quando senti questa e sei completamente presente","questa canzone √® il fuoco che brucia piano","il tipo di beat per le cose non dette","questa l'ho ascoltata con qualcuno e ora √® legata a lui/lei","quando la musica diventa una presenza fisica","questa √® per i momenti in cui tutto il resto scompare","il tipo di ritmo che non chiede permesso","questa canzone √® ipnotica e consapevole","quando senti questa vuoi viverla completamente","questa √® la canzone per i momenti di massima intensit√†","il tipo di musica che si sente sulla pelle","questa l'ascolto e mi sento al centro di qualcosa","quando il groove crea qualcosa tra le persone","questa canzone √® il tipo di bellezza che non si spiega"
            ],
            savage: [
                "no scusa ci tengo a precisare che sto bene","il tipo di energia per quando sei stanca/o di essere gentile","questa canzone √® per quando hai esaurito la pazienza","quando hai smesso di chiedere scusa per esistere","questa √® la colonna sonora del non me ne frega pi√π","il tipo di ritmo per chi non torna indietro","questa l'ascolto quando devo ricordarmi che valgo","quando sei arrivata/o al punto di non ritorno","questa canzone √® per chi ha imparato a fare a meno delle persone sbagliate","il tipo di musica per i momenti di chiarezza brutale","questa √® la mia canzone per quando dico basta","quando hai smesso di aspettare che qualcuno ti valorizzi","questa canzone √® la mia risposta a tutte le stronzate","il tipo di ritmo per chi non abbassa pi√π la testa","questa l'ho messa quando ho capito che non avevo bisogno di loro","quando smetti di essere disponibile per chi non lo merita","questa canzone √® per chi ha imparato che i no si possono dire","il tipo di energia per quando hai le idee chiare","questa √® la colonna sonora della mia era senza scuse","quando decidi che basta e basta","questa canzone √® per chi non chiede pi√π permesso di brillare","il tipo di ritmo per i momenti di potere personale","questa l'ascolto quando ho bisogno di ricordarmi chi sono","quando hai smesso di sminuirti per far stare bene gli altri","questa √® la mia canzone per i momenti di rispetto per s√©","il tipo di musica per chi ha imparato i propri confini","questa √® per chi ha smesso di essere uno zerbino","quando ti rendi conto del tuo valore e nessuno pu√≤ toglierlo","questa canzone √® la firma della mia indipendenza","il tipo di beat per chi non si fa calpestare","questa l'ho messa quando ho smesso di tollerare","quando hai pi√π forza di quanto pensavi","questa √® la canzone per il momento in cui dici no e basta","il tipo di ritmo per chi ha trovato la propria spina dorsale","questa l'ascolto quando devo fare cose difficili ma necessarie","quando capisci che stavi dando troppo alle persone sbagliate","questa canzone √® per chi non ha pi√π tempo da perdere","il tipo di musica per chi sa che √® cambiato/a in meglio","questa √® la colonna sonora del mio glow up","quando hai smesso di giustificarti con chi non capir√† mai","questa canzone √® potere personale in forma sonora","il tipo di ritmo per i momenti di svolta","questa l'ho messa dopo l'ultima volta che ho detto s√¨ quando volevo dire no","quando la tua energia √® troppo preziosa per gli altri","questa √® la canzone per chi ha imparato il proprio valore","il tipo di musica per i momenti in cui sei al primo posto","questa l'ascolto e mi ricordo che non ho bisogno di validazione","quando hai smesso di shrinkare per far sentire gli altri pi√π grandi","questa canzone √® per chi non abbassa pi√π il volume della propria personalit√†","il tipo di beat per chi ha trovato la sua forza","questa √® la mia risposta a tutti i no ricevuti ingiustamente","quando decidi di smettere di essere piccola/o","questa canzone √® per chi finalmente si mette al primo posto","il tipo di ritmo per le persone che si rispettano","questa l'ho messa quando ho smesso di volermi bene meno degli altri","quando capisci che la tua pace vale pi√π di qualsiasi relazione tossica","questa √® la canzone per i momenti di massima consapevolezza","il tipo di musica per chi ha imparato che rifiutare √® okay","questa √® per chi ha smesso di essere responsabile dei problemi degli altri","quando ti rendi conto che non devi dimostrare niente a nessuno","questa canzone √® l'energia di chi sa cosa vuole e sa dire no","il tipo di beat per le persone che hanno imparato da tutto","questa l'ascolto quando voglio sentirmi intera/o e senza rimpianti","quando hai il coraggio di essere esattamente chi sei","questa √® la colonna sonora di chi si √® preso indietro","il tipo di ritmo per chi non √® pi√π disponibile all'ennesima chance","questa canzone √® per chi ha scelto s√© stesso/a definitivamente","quando smetti di spiegare e inizi solo a fare","questa √® la mia canzone per i momenti in cui sono me stessa/o senza scuse","il tipo di musica per chi ha imparato che il rispetto non si chiede, si impone"
            ],
            aesthetic: [
                "questa canzone √® il mio mood board in forma sonora","il tipo di musica che diventa la tua firma personale","questa √® esattamente la mia vibe","quando la canzone cattura la tua essenza","questa √® la colonna sonora del mio universo estetico","il tipo di ritmo che definisce uno stile","questa l'ascolto e mi sento nel mio personaggio","quando la musica diventa la tua identit√†","questa canzone √® il suono della mia estetica","il tipo di beat che si abbina al tuo look","questa √® la canzone del mio aesthetic","quando senti questa e pensi ai tuoi tumblr post di 5 anni fa","questa canzone √® il film nella mia testa","il tipo di musica che diventa la firma della tua era","questa l'ascolto e visualizzo la mia vita come voglio che sia","quando la canzone √® cos√¨ tua che sembra fatta per te","questa √® il sound che cerco sempre","il tipo di ritmo che si abbina alla luce dorata","questa canzone √® il mio modo di esistere","quando la musica e la tua identit√† si fondono","questa √® la colonna sonora dei miei momenti pi√π me","il tipo di beat per chi ha curato la propria vibe","questa l'ascolto e mi sento nel mio mondo","quando senti questa e la tua estetica personale ha senso","questa canzone √® per chi vive con intenzione","il tipo di musica per i momenti cinematic della tua vita","questa √® la traccia dei miei pomeriggi dorati","quando la canzone cattura il tuo mood estetico perfettamente","questa canzone √® il suono di chi sa chi √®","il tipo di ritmo per i collezionisti di momenti belli","questa l'ascolto mentre guardo la pioggia dalla finestra","quando la musica diventa parte del tuo mondo visivo","questa √® per i curatori di esperienze","il tipo di beat che si abbina alle foto che non pubblichi","questa canzone √® il colore della mia giornata","quando senti questa e visualizzi sequenze di vita belle","questa √® la mia canzone per i momenti estetici","il tipo di musica per chi vive lentamente e con stile","questa l'ascolto e immagino la versione migliore di me","quando la canzone √® cos√¨ coerente con te che fa paura","questa canzone √® il tuo manifesto visivo in audio","il tipo di ritmo per i momenti fotografici della vita","questa √® per chi curava la propria energy prima che fosse un trend","quando senti questa e capisci cosa intendono per vibe","questa canzone √® l'estetica che cerco di vivere","il tipo di beat per i momenti di massima consapevolezza sensoriale","questa l'ascolto mentre mi perdo in qualcosa di bello","quando la musica diventa lo sfondo perfetto della tua vita","questa √® la colonna sonora delle mie ore dorate","il tipo di ritmo che diventa il tuo brand personale","questa canzone √® per chi cura il proprio universo","quando senti questa e la tua identity ha una traccia audio","questa √® la mia canzone per i momenti di bellezza quotidiana","il tipo di musica per i momento in cui ti senti nella tua storia","questa l'ascolto e mi sento esattamente come voglio essere","quando la canzone descrive il tuo mood senza usare parole","questa canzone √® l'audio del mio aesthetic preferito","il tipo di beat per i pomeriggi lenti e belli","questa √® per chi colleziona momenti pi√π che cose","quando senti questa e il tuo senso estetico vibra","questa canzone √® il suono del mio lifestyle","il tipo di ritmo per i momenti di quiete visiva","questa l'ascolto quando voglio essere nella mia dimensione","quando la musica cattura quello che le foto non riescono","questa √® la colonna sonora della mia vita come voglio che sia","il tipo di beat per i momenti di pura espressione personale","questa canzone √® la mia firma sonora","quando senti questa e finalmente hai trovato il tuo sound","questa √® per chi vive con cura e intenzione","il tipo di musica che diventa parte di te senza che te ne accorgi","questa l'ascolto e mi sento nel mio element","quando la canzone √® cos√¨ coerente con chi sei che sembra magia","questa canzone √® il tuo mondo interiore che suona"
            ],
            relatable: [
                "no ma perch√© questa canzone sa tutto di me","il tipo di brano che ti guarda negli occhi","questa √® letteralmente la colonna sonora della mia vita","quando ascolti una canzone e pensi stai parlando di me?","questa canzone mi ha smascherato","il tipo di testo che sembra scritto dal tuo diario","questa √® la canzone del mio esatto momento","quando la musica √® troppo precisa per essere un caso","questa canzone capisce me meglio di me stessa/o","il tipo di brano che fa venire voglia di rispondere ai testi","questa √® la mia situazione in una canzone","quando senti qualcosa e pensi aspetta questa sono io","questa canzone ha detto ad alta voce quello che non riuscivo a pensare","il tipo di musica per chi si sente sempre un po' fuori posto","questa √® la canzone per tutti quelli che si riconoscono","quando la musica descrive la tua rottura interiore con precisione","questa √® la colonna sonora di tutti i miei overthinking","il tipo di brano per i chronic overthinker","questa canzone mi ha vista/o senza che glielo chiedessi","quando senti questo e pensi ma come fa a saperlo","questa √® esattamente come mi sento ultimamente","il tipo di musica per chi sente troppo","questa ha detto le cose che avevo in testa da mesi","quando una canzone articola quello che non riesci ad articolare","questa √® per tutti i my feeling not mine","il tipo di brano che fa fare quella smorfia di riconoscimento","questa canzone √® il mio internal monologue","quando la musica √® il tuo portavoce non richiesto","questa √® la canzone per chi si sente spesso incompreso/a","il tipo di testo che sembra scritto da qualcuno che ti conosce","questa canzone mi ha fatto venire voglia di inviarlo a tutte le persone","quando qualcosa descrive cos√¨ bene la tua esperienza da far paura","questa √® per chi annuisce mentre ascolta","il tipo di brano per le persone che pensano troppo","questa canzone √® la mia vita frullata in 3 minuti","quando senti questa e per una volta qualcuno capisce","questa √® esattamente la mia vibrazione in questo periodo","il tipo di musica per i momenti di riconoscimento totale","questa ha detto quello che non avrei mai saputo dire","quando la canzone cattura l'esperienza umana con precisione","questa canzone √® per tutti quelli che si sentono cos√¨","il tipo di brano che fa scoppiare a ridere e piangere insieme","questa √® la colonna sonora del mio caos interiore","quando senti questa e pensi finalmente qualcuno lo ha detto","questa √® per i momenti in cui ti senti osservato/a da una canzone","il tipo di musica per chi ha emozioni troppo complesse da spiegare","questa canzone √® il mio exactly feeling","quando la musica ti fa sentire meno sola/o nel tuo modo di essere","questa √® per chi annuisce con tutto il corpo mentre ascolta","il tipo di brano per chi si riconosce in tutto","questa canzone ha fatto quello che nessun terapista ha fatto","quando senti questa e vuoi mandarlo a tutte le persone a cui vuoi bene","questa √® esattamente come mi sento e non sapevo come dirlo","il tipo di musica per i momenti di epifania sonora","questa l'ascolto e penso s√¨, esatto, questo","quando la canzone parla di te senza conoscerti","questa canzone √® la mia confessione non scritta","il tipo di brano che fa venire voglia di condividerlo con tutti","questa √® per tutti quelli che pensano ci sia qualcosa di sbagliato in loro","quando senti questa e finalmente ti senti normale","questa canzone √® universalmente personale","il tipo di musica per chi non si √® mai sentito capito abbastanza","questa ha detto tutto quello che evitavo di pensare","quando la musica diventa la tua voce","questa √® per chi si riconosce pi√π nelle canzoni che nella vita reale","il tipo di brano per le persone che sentono tutto troppo intensamente","questa canzone √® il mio momento di essere finalmente vista/o","quando senti questa e per una volta non sei sola/o nel tuo modo di stare","questa √® la canzone per tutti quelli che si sono riconosciuti"
            ],
            dreamy: [
                "questa canzone mi porta via","il tipo di musica per quando vuoi essere altrove","questa √® la colonna sonora dei miei sogni pi√π belli","quando senti questa il mondo reale scompare","questa canzone √® un posto che non esiste ma vorrei visitare","il tipo di ritmo per i pomeriggi in cui sogni a occhi aperti","questa l'ascolto e mi immagino una vita diversa","quando la musica crea mondi paralleli","questa canzone √® il mio posto sicuro immaginario","il tipo di beat per i viaggi mentali","questa √® la traccia dei miei sogni lucidi","quando senti questa e sei in mezzo tra qui e altrove","questa canzone √® pura fantasia in forma sonora","il tipo di musica per le strade notturne senza meta","questa l'ascolto quando voglio abitare un'altra dimensione","quando il suono diventa un paesaggio","questa √® la canzone dei miei pomeriggi dorati immaginari","il tipo di ritmo per chi vive di sogni piccoli e grandi","questa canzone √® il mio cinema personale","quando senti questa e la realt√† diventa morbida","questa √® per i momenti di fuga gentile","il tipo di beat che apre portali","questa l'ascolto e flutto","quando la musica ti porta in un'altra stagione","questa canzone √® alba in un posto sconosciuto","il tipo di ritmo per i sognatori cronici","questa √® la colonna sonora di vite parallele","quando senti questa e stai viaggiando senza muoverti","questa canzone √® il cielo di notte in forma sonora","il tipo di musica per i momenti di contemplazione","questa l'ascolto quando voglio uscire da qui senza alzarmi","quando la musica diventa un sogno ad occhi aperti","questa √® per chi abita spesso la propria testa","il tipo di beat per i momenti di pura evasione","questa canzone √® il luogo in cui mi rifugio","quando senti questa e il tempo si dilata","questa √® la traccia dei miei pensieri pi√π liberi","il tipo di ritmo per chi ama perdersi","questa l'ascolto e visualizzo mondi che non ho visto","quando la musica √® cos√¨ bella da diventare un posto","questa canzone √® il mio posto preferito che non esiste","il tipo di musica per le ore sospese della notte","questa √® per i momenti in cui sei tra pi√π cose insieme","quando senti questa e la mente vaga liberamente","questa canzone √® il mio sci-fi personale","il tipo di beat per i pomeriggi senza gravit√†","questa l'ascolto quando ho voglia di nuvole","quando la musica crea paesaggi interni","questa √® la colonna sonora delle mie fantasie pi√π belle","il tipo di ritmo per chi si nutre di sogni","questa canzone √® un posto dove andare senza andare da nessuna parte","quando senti questa e sei contemporaneamente qui e altrove","questa √® per i momenti di dissolvenza gentile dalla realt√†","il tipo di beat per chi vive nelle proprie visioni","questa l'ascolto quando voglio abitare il mio immaginario","quando la musica √® cos√¨ onirica che quasi non la senti","questa canzone √® il suono di quello che potrebbe essere","il tipo di ritmo per i viandanti sognatori","questa √® la traccia dei miei momenti di pace profonda","quando senti questa e capisci cosa vuol dire fluttuare","questa canzone √® universo in miniatura","il tipo di musica per i momenti tra sonno e veglia","questa l'ascolto e penso a tutte le vite che non vivr√≤ mai","quando la canzone ti trasporta con gentilezza","questa √® per chi abita i propri sogni con cura","il tipo di beat per le notti stellate della mente","questa canzone √® il mio posto preferito in assoluto","quando senti questa il mondo diventa un posto pi√π bello","questa √® la colonna sonora dei sogni che vale la pena sognare","il tipo di ritmo per chi sa volare stando fermi"
            ],
            chaotic: [
                "questa canzone capisce la mia energia caotica","il tipo di brano per quando hai tre cose in testa insieme","questa √® per chi non sa stare ferma/o","quando la tua vita sembra un piano B improvvisato","questa canzone √® la mia mente di gioved√¨ pomeriggio","il tipo di ritmo per le persone che fanno tutto di corsa","questa l'ascolto quando sono in quel mood impossibile da spiegare","quando non sai se stai bene o male e balli lo stesso","questa canzone √® l'energia di chi ha troppe tab aperte","il tipo di musica per i momenti di caos creativo","questa √® per chi improvvisa anche la vita","quando senti questa e finalmente qualcuno capisce la tua energia","questa canzone √® il mio cervello alle 23","il tipo di ritmo per chi √® spontaneo per costituzione","questa l'ascolto quando la giornata √® andata in modo imprevedibile","quando hai fatto 5 cose non correlate e sei felice lo stesso","questa √® la canzone dei piani che cambiano ogni ora","il tipo di musica per chi ama l'entropia","questa canzone √® il tipo di energia che fa chiedere stai bene?","quando il caos √® il tuo stato naturale e ci stai bene","questa √® per chi trasforma il disordine in arte","il tipo di ritmo per le persone che si svegliano con 20 idee","questa l'ascolto quando sto facendo tre cose contemporaneamente","quando la tua vita √® un montaggio veloce di scene non correlate","questa canzone capisce il mio vibe caotico neutrale","il tipo di musica per i momenti in cui non sai cosa stai facendo ma lo fai","questa √® per chi fa le cose important the hard way","quando senti questa e ti senti riconosciuto/a nel caos","questa canzone √® la mia firma energetica","il tipo di ritmo per i creatori compulsivi","questa l'ascolto e mi do il permesso di non avere un piano","quando stai bene nel disordine e non lo sai spiegare","questa √® la canzone per i momento in cui tutto √® caotico ma okay","il tipo di musica per chi non segue il manuale","questa canzone √® il mio stato mentale delle 14","quando hai iniziato 4 cose e non ne hai finita nessuna ma sei in vibe","questa √® per chi ama le sorprese che si √® creato da solo/a","il tipo di ritmo per i moment in cui corri senza sapere dove vai","questa l'ascolto quando devo fare troppe cose ma voglio ballare","quando la vita non ha senso ma questa canzone s√¨","questa canzone √® per il caos creativo che √® la tua personalit√†","il tipo di musica per le teste che non si fermano mai","questa √® la colonna sonora delle mie giornate impossibili","quando stai vivendo 5 trame diverse contemporaneamente","questa canzone √® il mio energy drink sonoro","il tipo di ritmo per chi ha l'ADHD dell'anima","questa l'ascolto e mi sento in controllo del caos","quando le cose vanno per la loro e tu ci vai dietro cantando","questa √® per i creatori di situazioni impreviste","il tipo di musica per chi trova pace nell'imprevedibile","questa canzone √® il ritmo del mio braindump","quando non sai da dove viene l'energia ma ce l'hai","questa √® la traccia dei miei momenti di massima vitalit√† caotica","il tipo di ritmo per chi improvvisa anche le emozioni","questa l'ascolto quando sono in modalit√† everything everywhere","quando hai mille idee e zero metodo e funziona lo stesso","questa canzone √® per i sistematicamente disorganizzati","il tipo di musica per i creatori notturni","questa √® la colonna sonora del mio cervello che lavora","quando la confusione √® produttiva e hai trovato la canzone giusta","questa canzone √® il mio terremoto gentile quotidiano","il tipo di ritmo per chi abbraccia l'imprevedibilit√†","questa l'ascolto quando la mia vita sta superando le aspettative in modo incontrollato","quando sei nel tuo chaos mode e non hai intenzione di uscirne","questa √® per chi vive meglio senza piano fisso"
            ],
            main: [
                "questa √® la canzone del mio chapter attuale","il tipo di musica per quando capisci che sei il protagonista","questa √® la colonna sonora del mio momento","quando senti questa e la vita sembra un film bello","questa √® la mia canzone dell'anno, forse della vita","il tipo di ritmo per chi sta vivendo la sua storia","questa l'ascolto nei momenti che voglio ricordare","quando cammini con questa e la citt√† √® tua","questa canzone √® il mio montaggio cinematografico","il tipo di musica per i momenti di rivelazione personale","questa √® la traccia del mio personaggio","quando senti questa e capisci di essere nel momento giusto","questa canzone √® il suono della mia crescita","il tipo di ritmo per chi ha capito chi √®","questa l'ascolto quando voglio sentirmi la protagonista della mia storia","quando la vita diventa cinematografica con questa canzone","questa √® per i momenti in cui capisci che stai diventando qualcuno","il tipo di musica per i capitoli importanti","questa canzone √® il mio manifesto sonoro","quando senti questa e sai che stai vivendo qualcosa di reale","questa √® la colonna sonora del mio glow up","il tipo di ritmo per chi sta scrivendo la sua storia migliore","questa l'ascolto e mi ricordo perch√© sto facendo quello che faccio","quando la canzone coglie esattamente la tua era","questa canzone √® per i momenti di massima lucidit√†","il tipo di musica per chi ha trovato la sua strada","questa √® per chi sta vivendo il suo arco narrativo","quando senti questa e vuoi documentare il momento","questa canzone √® il suono del mio diventare","il tipo di ritmo per i protagonisti silenziosi","questa l'ascolto nei momenti decisivi","quando la musica fa sentire che stai andando dove devi","questa √® la canzone per chi sta costruendo qualcosa","il tipo di musica per i momenti di transizione importante","questa canzone √® il tema musicale della mia storia","quando senti questa e sai che sei esattamente dove devi essere","questa √® per chi sta vivendo la sua svolta","il tipo di ritmo per i momenti di massima consapevolezza","questa l'ascolto quando sto facendo le cose che contano","quando la canzone diventa la firma del tuo capitolo","questa canzone √® la mia colonna sonora di questo periodo","il tipo di musica per chi √® nel mezzo della sua storia pi√π bella","questa √® per i momenti in cui ti senti pienamente viva/o","quando senti questa e capisci che sei il main character","questa canzone √® il suono della mia vita che prende forma","il tipo di ritmo per chi vive con intenzione e presenza","questa l'ascolto quando voglio sentirmi nel mio arco narrativo","quando la musica coglie esattamente il tuo momento di vita","questa √® la canzone del capitolo migliore","il tipo di musica per i protagonisti in costruzione","questa canzone √® il mio momento di massima versione","quando senti questa e vorresti che tutti lo vedessero","questa √® per chi sta diventando la persona che voleva essere","il tipo di ritmo per i momenti di riconoscimento personale","questa l'ascolto e penso s√¨, questo sono io","quando la canzone capisce esattamente dove sei nella tua storia","questa canzone √® la soundtrack della mia evoluzione","il tipo di musica per i momenti in cui sei protagonista involontario","questa √® per chi sta vivendo la sua migliore stagione","quando senti questa e vuoi fermare il momento","questa canzone √® il suono di chi sta crescendo","il tipo di ritmo per le storie che vale la pena raccontare","questa l'ascolto nei momenti che diventeranno ricordi importanti","quando la musica ti fa capire che stai gi√† nella parte migliore","questa √® la colonna sonora di chi si √® scelto/a","il tipo di musica per i momenti di pura presenza","questa canzone √® la mia era migliore in forma sonora","quando senti questa e capisci che la tua storia merita di essere vissuta","questa √® per chi sa di essere nel mezzo di qualcosa di importante","il tipo di ritmo per i protagonisti della propria vita","questa l'ascolto quando so che questo momento sar√† speciale","quando la canzone diventa il suono del tuo momento pi√π autentico"
            ]
        };

        let selectedCategory = 'happy';

        document.querySelectorAll('.caption-cat-btn').forEach(btn => {
            btn.onclick = () => {
                document.querySelectorAll('.caption-cat-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                selectedCategory = btn.dataset.category;
            };
        });

        document.getElementById('random-caption-btn').onclick = () => {
            const captions = viralCaptions[selectedCategory];
            const randomCaption = captions[Math.floor(Math.random() * captions.length)];
            
            document.getElementById('caption-input').value = randomCaption;
            caption.innerText = randomCaption;
            
            const btn = document.getElementById('random-caption-btn');
            btn.style.transform = 'scale(0.95)';
            setTimeout(() => btn.style.transform = 'scale(1)', 100);
        };

        // ============================================
        // EXPORT ALL FUNCTIONALITY
        // ============================================
        
        document.getElementById('export-all-btn').onclick = async () => {
            if (videoQueue.length === 0) {
                alert('La coda √® vuota! Aggiungi video prima di esportare.');
                return;
            }

            const exportAllBtn = document.getElementById('export-all-btn');
            exportAllBtn.disabled = true;
            
            const status = document.getElementById('export-status');
            const progress = document.getElementById('progress-bar');
            const statusText = document.getElementById('status-text');
            const percentText = document.getElementById('percent-text');
            
            status.classList.remove('hidden');

            try {
                for (let queueIndex = 0; queueIndex < videoQueue.length; queueIndex++) {
                    const item = videoQueue[queueIndex];
                    
                    statusText.innerText = `Video ${queueIndex + 1}/${videoQueue.length}: Preparazione...`;
                    progress.style.width = '0%';
                    percentText.innerText = '0%';

                    // Setup video source
                    const sourceVideo = document.getElementById('source-video');
                    sourceVideo.src = URL.createObjectURL(item.videoFile);
                    await new Promise(r => sourceVideo.onloadedmetadata = r);

                    const renderCanvas = document.getElementById('render-canvas');
                    const renderCtx = renderCanvas.getContext('2d');
                    
                    const targetWidth = 720;
                    const targetHeight = 1280;
                    
                    renderCanvas.width = targetWidth;
                    renderCanvas.height = targetHeight;

                    const fps = 30;
                    const duration = item.vEnd - item.vStart;

                    const { Muxer, ArrayBufferTarget } = window.Mp4Muxer;

                    const muxerConfig = {
                        target: new ArrayBufferTarget(),
                        video: {
                            codec: 'avc',
                            width: renderCanvas.width,
                            height: renderCanvas.height
                        },
                        fastStart: 'in-memory'
                    };

                    if (item.audioFile) {
                        muxerConfig.audio = {
                            codec: 'aac',
                            numberOfChannels: 2,
                            sampleRate: 48000
                        };
                    }

                    const muxer = new Muxer(muxerConfig);
                    
                    const videoEncoder = new VideoEncoder({
                        output: (chunk, meta) => muxer.addVideoChunk(chunk, meta),
                        error: e => {
                            console.error('Video encoder error:', e);
                            throw new Error('Errore di codifica video: ' + e.message);
                        }
                    });

                    videoEncoder.configure({
                        codec: 'avc1.42001F',
                        width: renderCanvas.width,
                        height: renderCanvas.height,
                        bitrate: 8_000_000,
                        framerate: fps,
                        avc: { format: 'avc' }
                    });

                    let audioEncoder = null;
                    let audioData = null;

                    if (item.audioFile) {
                        const audioContext = new AudioContext({ sampleRate: 48000 });
                        const audioBuffer = await item.audioFile.arrayBuffer();
                        const decodedAudio = await audioContext.decodeAudioData(audioBuffer);
                        
                        const startSample = Math.floor(item.aStart * decodedAudio.sampleRate);
                        const endSample = Math.floor((item.aStart + duration) * decodedAudio.sampleRate);
                        const sampleCount = endSample - startSample;
                        
                        audioData = {
                            left: new Float32Array(sampleCount),
                            right: new Float32Array(sampleCount),
                            sampleRate: decodedAudio.sampleRate
                        };
                        
                        const leftChannel = decodedAudio.getChannelData(0);
                        const rightChannel = decodedAudio.numberOfChannels > 1 ? decodedAudio.getChannelData(1) : leftChannel;
                        
                        for (let i = 0; i < sampleCount; i++) {
                            audioData.left[i] = leftChannel[startSample + i] || 0;
                            audioData.right[i] = rightChannel[startSample + i] || 0;
                        }

                        audioEncoder = new AudioEncoder({
                            output: (chunk, meta) => muxer.addAudioChunk(chunk, meta),
                            error: e => {
                                console.error('Audio encoder error:', e);
                                throw new Error('Errore di codifica audio: ' + e.message);
                            }
                        });

                        audioEncoder.configure({
                            codec: 'mp4a.40.2',
                            sampleRate: 48000,
                            numberOfChannels: 2,
                            bitrate: 128000
                        });
                    }

                    sourceVideo.currentTime = item.vStart;
                    await new Promise(r => sourceVideo.onseeked = r);

                    const totalFrames = Math.ceil(duration * fps);
                    const targetSampleRate = 48000;
                    const sourceSampleRate = audioData ? audioData.sampleRate : 48000;
                    const samplesPerFrame = Math.floor(targetSampleRate / fps);
                    let audioSampleOffset = 0;

                    // Container height for scaling (using a standard preview height)
                    const previewHeight = 515; // Standard preview container height
                    const exportHeight = renderCanvas.height;
                    const scaleFactor = exportHeight / previewHeight;

                    for (let i = 0; i < totalFrames; i++) {
                        const timestamp = i / fps;
                        sourceVideo.currentTime = item.vStart + timestamp;
                        await new Promise(r => sourceVideo.onseeked = r);

                        // Draw video with optional zoom
                        if (item.removeWatermark) {
                            const scale = 1.1;
                            const scaledWidth = sourceVideo.videoWidth * scale;
                            const scaledHeight = sourceVideo.videoHeight * scale;
                            const offsetX = -(scaledWidth - renderCanvas.width) / 2;
                            const offsetY = -(scaledHeight - renderCanvas.height) / 2;
                            
                            renderCtx.drawImage(sourceVideo, offsetX, offsetY, scaledWidth, scaledHeight);
                        } else {
                            renderCtx.drawImage(sourceVideo, 0, 0, renderCanvas.width, renderCanvas.height);
                        }

                        // Draw caption with word wrapping
                        if (item.caption && item.caption !== 'Scrivi il tuo testo') {
                            const scaledFontSize = item.fontSize * scaleFactor;
                            const scaledMaxWidth = item.captionMaxWidthPx * scaleFactor;

                            let fontFamily = 'Montserrat';
                            if (item.fontClass.includes('font-typewriter')) fontFamily = 'Courier Prime';
                            else if (item.fontClass.includes('font-classic')) fontFamily = 'Inter';
                            else if (item.fontClass.includes('font-handwriting')) fontFamily = 'Dancing Script';

                            renderCtx.font = `800 ${scaledFontSize}px ${fontFamily}`;
                            renderCtx.textAlign = 'center';
                            renderCtx.textBaseline = 'top';

                            function wrapText(text, maxWidth) {
                                const words = text.split(' ');
                                const lines = [];
                                let currentLine = words[0];

                                for (let i = 1; i < words.length; i++) {
                                    const testLine = currentLine + ' ' + words[i];
                                    const metrics = renderCtx.measureText(testLine);
                                    if (metrics.width > maxWidth) {
                                        lines.push(currentLine);
                                        currentLine = words[i];
                                    } else {
                                        currentLine = testLine;
                                    }
                                }
                                lines.push(currentLine);
                                return lines;
                            }

                            const lines = wrapText(item.caption, scaledMaxWidth);
                            const lineHeight = scaledFontSize * 1.2;
                            const textY = item.captionTopPx * scaleFactor;

                            lines.forEach((line, index) => {
                                const y = textY + (index * lineHeight);
                                
                                if (item.hasOutline) {
                                    renderCtx.strokeStyle = item.outlineColor;
                                    renderCtx.lineWidth = Math.max(scaleFactor * 1.5, 3);
                                    renderCtx.lineJoin = 'round';
                                    renderCtx.miterLimit = 2;
                                    renderCtx.strokeText(line, renderCanvas.width / 2, y);
                                }

                                renderCtx.fillStyle = item.textColor;
                                renderCtx.fillText(line, renderCanvas.width / 2, y);
                            });
                        }

                        const videoFrame = new VideoFrame(renderCanvas, {
                            timestamp: (i * 1_000_000) / fps
                        });

                        videoEncoder.encode(videoFrame, { keyFrame: i % 30 === 0 });
                        videoFrame.close();

                        if (audioEncoder && audioData) {
                            const resampleRatio = sourceSampleRate / targetSampleRate;
                            const sourceSamplesNeeded = Math.floor(samplesPerFrame * resampleRatio);
                            
                            const leftChannel = new Float32Array(samplesPerFrame);
                            const rightChannel = new Float32Array(samplesPerFrame);
                            
                            for (let j = 0; j < samplesPerFrame; j++) {
                                const sourceIndex = Math.floor(audioSampleOffset + (j * resampleRatio));
                                if (sourceIndex < audioData.left.length) {
                                    leftChannel[j] = audioData.left[sourceIndex];
                                    rightChannel[j] = audioData.right[sourceIndex];
                                } else {
                                    leftChannel[j] = 0;
                                    rightChannel[j] = 0;
                                }
                            }

                            const audioFrame = new AudioData({
                                format: 'f32-planar',
                                sampleRate: targetSampleRate,
                                numberOfFrames: samplesPerFrame,
                                numberOfChannels: 2,
                                timestamp: (i * 1_000_000) / fps,
                                data: new Float32Array([...leftChannel, ...rightChannel])
                            });

                            audioEncoder.encode(audioFrame);
                            audioFrame.close();
                            
                            audioSampleOffset += sourceSamplesNeeded;
                        }

                        const progressPercent = Math.round((i / totalFrames) * 100);
                        progress.style.width = progressPercent + '%';
                        percentText.innerText = progressPercent + '%';

                        if (i % 10 === 0) {
                            await new Promise(r => setTimeout(r, 0));
                        }
                    }

                    await videoEncoder.flush();
                    if (audioEncoder) await audioEncoder.flush();
                    muxer.finalize();

                    const buffer = muxer.target.buffer;
                    const blob = new Blob([buffer], { type: 'video/mp4' });
                    
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    const sanitizedCaption = (item.caption || 'video').substring(0, 30).replace(/[^a-z0-9]/gi, '_');
                    a.download = `TikTok_${queueIndex + 1}_${sanitizedCaption}.mp4`;
                    a.click();
                    
                    URL.revokeObjectURL(url);
                    
                    // Small delay between downloads
                    await new Promise(r => setTimeout(r, 500));
                }

                statusText.innerText = 'Tutti i video esportati!';
                percentText.innerText = '100%';
                progress.style.width = '100%';
                
                setTimeout(() => {
                    status.classList.add('hidden');
                    exportAllBtn.disabled = false;
                }, 3000);

            } catch (e) {
                console.error('Errore durante l\'export bulk:', e);
                statusText.innerText = 'Errore: ' + e.message;
                alert('Errore durante l\'export bulk. Controlla la console per dettagli.');
                setTimeout(() => status.classList.add('hidden'), 3000);
                exportAllBtn.disabled = false;
            }
        };
    </script>
</body>
</html>
