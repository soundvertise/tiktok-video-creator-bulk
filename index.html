<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Ads Creator PRO | Soundvertise</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/mp4-muxer@latest/build/mp4-muxer.js"></script>
    <style>
        :root { --sv-purple: #8B5CF6; --sv-blue: #3B82F6; --sv-bg: #050505; --sv-card: #0F0F0F; }
        body { background-color: var(--sv-bg); color: #ffffff; font-family: 'Inter', sans-serif; }
        .btn-xl { padding: 1.25rem; font-size: 1.1rem; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; transition: all 0.2s; }
        .btn-xl:active { transform: scale(0.95); }
        .glass { background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); }
        .active-item { border: 2px solid var(--sv-blue) !important; background: rgba(59, 130, 246, 0.1); }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-12 gap-8">
        
        <div class="lg:col-span-7 space-y-6">
            <div class="glass p-6 rounded-3xl">
                <h2 class="text-2xl font-black mb-6 flex items-center gap-2">
                    <i data-lucide="layers"></i> EDITOR VIDEO
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div>
                        <label class="block text-xs font-bold text-gray-400 mb-2">SFONDO (URL VIDEO)</label>
                        <input type="text" id="videoUrl" class="w-full bg-black border border-gray-800 p-3 rounded-xl" placeholder="https://...">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-400 mb-2">BRANO MUSICALE</label>
                        <select id="audioSelect" class="w-full bg-black border border-gray-800 p-3 rounded-xl">
                            <option value="">Caricamento tracce...</option>
                        </select>
                    </div>
                </div>

                <div class="mb-6">
                    <label class="block text-xs font-bold text-gray-400 mb-2">MOOD CAPTION</label>
                    <div class="flex flex-wrap gap-2 mb-3">
                        <div id="moodContainer" class="flex flex-wrap gap-2"></div>
                    </div>
                    <textarea id="captionInput" class="w-full bg-black border border-gray-800 p-4 rounded-xl h-24" placeholder="Scrivi qualcosa di virale..."></textarea>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <button id="addVideoBtn" class="btn-xl bg-white text-black rounded-2xl flex items-center justify-center gap-2 hover:bg-gray-200">
                        <i data-lucide="plus-circle"></i> AGGIUNGI
                    </button>
                    <button id="saveEditBtn" class="btn-xl bg-blue-600 text-white rounded-2xl hidden flex items-center justify-center gap-2 hover:bg-blue-700">
                        <i data-lucide="save"></i> SALVA MODIFICHE
                    </button>
                    <button id="autoQueueBtn" class="btn-xl bg-purple-600 text-white rounded-2xl flex items-center justify-center gap-2 hover:bg-purple-700">
                        <i data-lucide="zap"></i> AUTO CODA (X5)
                    </button>
                </div>
            </div>

            <div class="glass p-4 rounded-3xl relative overflow-hidden aspect-[9/16] max-w-[350px] mx-auto group">
                <video id="mainVideo" class="w-full h-full object-cover rounded-2xl" loop muted playsinline></video>
                <div id="previewCaption" class="absolute inset-0 flex items-center justify-center p-8 text-center font-bold text-2xl pointer-events-none drop-shadow-2xl"></div>
                
                <div class="absolute bottom-6 left-1/2 -translate-x-1/2 flex gap-4">
                    <button id="playBtn" class="w-16 h-16 bg-white/20 backdrop-blur-md rounded-full flex items-center justify-center hover:bg-white/40 transition">
                        <i data-lucide="play" class="fill-white"></i>
                    </button>
                </div>
            </div>
        </div>

        <div class="lg:col-span-5 space-y-6">
            <div class="glass p-6 rounded-3xl h-fit">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-black">CODA EXPORT (<span id="queueCount">0</span>)</h2>
                    <button id="exportAllBtn" class="bg-green-500 hover:bg-green-600 text-black font-black px-6 py-3 rounded-xl flex items-center gap-2">
                        <i data-lucide="download"></i> EXPORT TUTTI
                    </button>
                </div>
                
                <div id="videoQueue" class="space-y-3 max-h-[600px] overflow-y-auto pr-2">
                    </div>
            </div>
        </div>
    </div>

    <audio id="mainAudio"></audio>

    <script>
        // --- DATABASE CAPTION "UMANE" (Esempio strutturato) ---
        const captionMoods = {
            viral: ["pov: hai finalmente trovato la canzone della vita ðŸ’€", "non cercatemi per i prossimi 3-5 giorni lavorativi", "questo drop vive nella mia testa gratis", "la sto ascoltando in loop da due ore, aiuto", "se non ti piace questa, abbiamo un problema"],
            gym: ["ultima serie o morte ðŸ˜¤", "il pre-workout ha appena fatto effetto", "immagina mollare proprio ora", "POV: sei a un passo dal nuovo PR", "la playlist Ã¨ il 70% dell'allenamento"],
            chill: ["vibrazioni della domenica sera âœ¨", "scollegati da tutto per un attimo", "niente stress, solo questa traccia", "il mood perfetto per non fare assolutamente nulla", "finestra aperta, pioggia e questo pezzo."],
            sensual: ["questa canzone ha un'aura assurda...", "non servono parole.", "mood: ðŸ•¯ï¸ðŸ–¤", "sentila e basta.", "troppo deep per spiegarlo a voce"],
            happy: ["impossibile stare fermi ðŸ’ƒ", "la dose di serotonina che ti serviva", "pov: Ã¨ venerdÃ¬ e hai appena staccato", "questa canzone sa di estate", "mandala a chi ha bisogno di un sorriso oggi"]
        };

        // Estendi il database per arrivare a 100+ (qui metto i placeholder per brevitÃ , ma la logica Ã¨ pronta)
        ['sad', 'dance', 'love', 'energy', 'party', 'beauty'].forEach(m => {
            captionMoods[m] = [`${m} vibes âœ¨`, `POV: sei in un film ${m}`, `questa traccia Ã¨ puramente ${m}`, `non riesco a smettere di ascoltarla #linkinbio`];
        });

        let videoQueue = [];
        let editingIndex = null;
        let audioList = [];

        // --- INIZIALIZZAZIONE ---
        async function init() {
            lucide.createIcons();
            setupMoods();
            await loadAudioList();
            setupEventListeners();
        }

        function setupMoods() {
            const container = document.getElementById('moodContainer');
            Object.keys(captionMoods).forEach(mood => {
                const btn = document.createElement('button');
                btn.className = "px-3 py-1 bg-white/10 hover:bg-white/20 rounded-full text-xs font-bold uppercase";
                btn.innerText = mood;
                btn.onclick = () => {
                    const quotes = captionMoods[mood];
                    document.getElementById('captionInput').value = quotes[Math.floor(Math.random() * quotes.length)];
                };
                container.appendChild(btn);
            });
        }

        async function loadAudioList() {
            // Simulazione fetch brani (Sostituire con tua API)
            audioList = [
                { id: 1, name: "Phonk Night", url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" },
                { id: 2, name: "LoFi Chill", url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3" },
                { id: 3, name: "Deep Techno", url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3" },
                { id: 4, name: "Summer Pop", url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-8.mp3" }
            ];
            const select = document.getElementById('audioSelect');
            select.innerHTML = audioList.map(a => `<option value="${a.url}">${a.name}</option>`).join('');
        }

        function setupEventListeners() {
            const playBtn = document.getElementById('playBtn');
            const v = document.getElementById('mainVideo');
            const a = document.getElementById('mainAudio');

            playBtn.onclick = () => {
                if (v.paused) {
                    // RESET AUDIO AL RE-PLAY (Richiesto)
                    a.currentTime = 0; // O usa startTime se implementato slider
                    v.play();
                    a.play();
                    playBtn.innerHTML = '<i data-lucide="pause" class="fill-white"></i>';
                } else {
                    v.pause();
                    a.pause();
                    playBtn.innerHTML = '<i data-lucide="play" class="fill-white"></i>';
                }
                lucide.createIcons();
            };

            document.getElementById('videoUrl').oninput = (e) => v.src = e.target.value;
            document.getElementById('audioSelect').onchange = (e) => a.src = e.target.value;
            document.getElementById('captionInput').oninput = (e) => document.getElementById('previewCaption').innerText = e.target.value;

            document.getElementById('addVideoBtn').onclick = () => addToQueue();
            document.getElementById('saveEditBtn').onclick = () => saveChanges();
            document.getElementById('autoQueueBtn').onclick = () => autoQueue(5);
        }

        // --- LOGICA CORE ---

        function addToQueue(customData = null) {
            const videoData = customData || {
                videoUrl: document.getElementById('videoUrl').value,
                audioUrl: document.getElementById('audioSelect').value,
                audioName: document.getElementById('audioSelect').options[document.getElementById('audioSelect').selectedIndex].text,
                caption: document.getElementById('captionInput').value,
                id: Date.now()
            };

            if(!videoData.videoUrl) return;

            videoQueue.push(videoData);
            renderQueue();
            resetForm();
        }

        function autoQueue(count) {
            const currentVideo = document.getElementById('videoUrl').value;
            if(!currentVideo) return;

            for(let i=0; i<count; i++) {
                // Prendi un brano a caso
                const randomAudio = audioList[Math.floor(Math.random() * audioList.length)];
                // Prendi un mood a caso e una caption a caso
                const moods = Object.keys(captionMoods);
                const randomMood = moods[Math.floor(Math.random() * moods.length)];
                const randomCaption = captionMoods[randomMood][Math.floor(Math.random() * captionMoods[randomMood].length)];

                addToQueue({
                    videoUrl: currentVideo,
                    audioUrl: randomAudio.url,
                    audioName: randomAudio.name,
                    caption: randomCaption,
                    id: Date.now() + i
                });
            }
        }

        function editVideo(index) {
            editingIndex = index;
            const item = videoQueue[index];
            
            document.getElementById('videoUrl').value = item.videoUrl;
            document.getElementById('audioSelect').value = item.audioUrl;
            document.getElementById('captionInput').value = item.caption;
            document.getElementById('mainVideo').src = item.videoUrl;
            document.getElementById('mainAudio').src = item.audioUrl;
            document.getElementById('previewCaption').innerText = item.caption;

            // UI Switch
            document.getElementById('addVideoBtn').classList.add('hidden');
            document.getElementById('saveEditBtn').classList.remove('hidden');
            
            renderQueue(); // Per mostrare lo stato "active"
        }

        function saveChanges() {
            if(editingIndex === null) return;

            videoQueue[editingIndex] = {
                ...videoQueue[editingIndex],
                videoUrl: document.getElementById('videoUrl').value,
                audioUrl: document.getElementById('audioSelect').value,
                audioName: document.getElementById('audioSelect').options[document.getElementById('audioSelect').selectedIndex].text,
                caption: document.getElementById('captionInput').value
            };

            editingIndex = null;
            document.getElementById('addVideoBtn').classList.remove('hidden');
            document.getElementById('saveEditBtn').classList.add('hidden');
            
            renderQueue();
            resetForm();
        }

        function deleteVideo(index) {
            // Niente conferma come richiesto
            videoQueue.splice(index, 1);
            if(editingIndex === index) resetForm();
            renderQueue();
        }

        function renderQueue() {
            const container = document.getElementById('videoQueue');
            const count = document.getElementById('queueCount');
            count.innerText = videoQueue.length;
            
            container.innerHTML = videoQueue.map((item, i) => `
                <div class="glass p-4 rounded-2xl flex items-center justify-between group ${editingIndex === i ? 'active-item' : ''}">
                    <div class="flex items-center gap-4 cursor-pointer" onclick="editVideo(${i})">
                        <div class="w-12 h-12 bg-purple-900/50 rounded-lg flex items-center justify-center font-bold">#${i+1}</div>
                        <div>
                            <div class="font-bold text-sm truncate w-40">${item.caption || 'Senza testo'}</div>
                            <div class="text-[10px] text-gray-400 uppercase tracking-widest">${item.audioName}</div>
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="editVideo(${i})" class="p-2 hover:bg-blue-500 rounded-lg transition"><i data-lucide="edit-3" class="w-4 h-4"></i></button>
                        <button onclick="deleteVideo(${i})" class="p-2 hover:bg-red-500 rounded-lg transition"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                    </div>
                </div>
            `).join('');
            lucide.createIcons();
        }

        function resetForm() {
            editingIndex = null;
            document.getElementById('captionInput').value = '';
            document.getElementById('previewCaption').innerText = '';
            document.getElementById('addVideoBtn').classList.remove('hidden');
            document.getElementById('saveEditBtn').classList.add('hidden');
            renderQueue();
        }

        init();
    </script>
</body>
</html>
